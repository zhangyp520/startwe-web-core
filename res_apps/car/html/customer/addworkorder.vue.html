<!--客户中心/ 新增客户页面 -->
<template>
    <div id="customer" v-loading="loading">
        <!-- 面包屑头部盒子开始 -->
        <div class="crumbs">
            <el-breadcrumb separator="/">
                <el-breadcrumb-item>
                    <a href="index4vue.html#res_apps/car/html/compnents/home.vue.html">首页</a>
                </el-breadcrumb-item>
                <el-breadcrumb-item>
                    <a href="index4vue.html#res_apps\car\html\customer\customer.vue.html">客户中心</a>
                </el-breadcrumb-item>
                <el-breadcrumb-item>新增客户</el-breadcrumb-item>
            </el-breadcrumb>
        </div>
        <!-- 面包屑头部盒子结束 -->
        <el-main>

            <!-- 右侧内部表单布局容器开始-- -->
            <!-- 第一行数据 -->
            <div class="content">
                <!-- 第一层 -->
                <div class="billing_time">
                    <ul>
                        <li>
                            <div>开单时间：</div>
                            <span>{{addCustomerFormValue.addWorkOrderInputDTO.orderDate}}</span>
                        </li>
                        <li>
                            <div>接待人员：</div>
                            <span>{{addCustomerFormValue.receiverName}}</span>
                        </li>
                        <li>
                            <div>进厂时间：</div>
                            <span>{{addCustomerFormValue.carEntryDate}}</span>
                        </li>

                    </ul>
                </div>

                <!-- 第二层 -->
                <div class="list_form">

                    <el-form :model="addCustomerFormValue" label-position="left" label-width="100px" :rules="rules" ref="addCustomerFormValue">

                        <div class=" v">
                            <div>
                                <el-form-item label=" 客户名称：" prop="custName">
                                    <!-- <el-input class="customer_icon" placeholder="请输入客户名" suffix-icon="el-icon-search"
                                        style="width: 160px;"></el-input> -->
                                    <div style=" position: relative; width: 160px; height: 40px;">
                                        <el-input style="width: 100%;" v-model="addCustomerFormValue.custName" placeholder="请输入/搜索客户名"></el-input>
                                        <span style=" width:20px; height: 20px; display: inline-block;  cursor:pointer;
                                        border-radius: 50%; position: absolute; right: 0; top: 0;" @click="searchCustomer">
                                            <img src="/res_apps/car/image/sousu.png" style="width: 12px;height: 12px;">
                                        </span>
                                    </div>
                                </el-form-item>

                            </div>
                            <div>
                                <el-form-item label="联系电话：" prop="custPhoneNo">
                                    <el-input v-model="addCustomerFormValue.custPhoneNo" placeholder="请输入电话号" style="width: 160px;">
                                    </el-input>
                                </el-form-item>

                            </div>

                            <div>
                                <el-form-item label=" 进厂里程：" prop="carMiles">
                                    <el-input v-model="addCustomerFormValue.carMiles" placeholder="请输入里程数" style="width: 160px;"></el-input>
                                </el-form-item>
                            </div>
                            <div>
                                <el-form-item label="客户来源" label-width="100px" prop="custFromType">
                                    <el-select v-model="addCustomerFormValue.custFromType" placeholder="请选择" style="width: 160px;">
                                        <el-option v-for="item in custFromType" :key="item.value" :label="item.label" :value="item.value"></el-option>
                                    </el-select>
                                </el-form-item>
                            </div>
                        </div>

                        <div class=" v">
                            <div>
                                <el-form-item label="业务类型" label-width="100px" prop="bizType">
                                    <el-select v-model="addCustomerFormValue.bizType" placeholder="请选择" style="width: 160px;">
                                        <el-option v-for="item in bizType" :key="item.value" :label="item.label" :value="item.value"></el-option>
                                    </el-select>
                                </el-form-item>

                            </div>
                            <div>
                                <el-form-item label="车载油量" label-width="100px" prop="oilMass">
                                    <el-select v-model="addCustomerFormValue.oilMass" placeholder="请选择" style="width: 160px;">
                                        <el-option v-for="item in surplus" :key="item.value" :label="item.label" :value="item.value"></el-option>
                                    </el-select>
                                </el-form-item>
                            </div>
                            <div>
                                <el-form-item label=" 随车物品：" prop="carAttachments">
                                    <el-input v-model="addCustomerFormValue.carAttachments" placeholder="请输入客户随车物品" style="width: 400px;"></el-input>
                                </el-form-item>

                            </div>
                        </div>

                        <div class=" v">
                            <div>
                                <el-form-item label=" 车辆品牌：" prop="carBrand">
                                    <el-input v-model="addCustomerFormValue.carBrand" placeholder="请输入品牌" style="width: 160px;">
                                    </el-input>
                                    <span style=" width:20px; height: 20px; display: inline-block;  cursor:pointer;
                                        border-radius: 50%; position: absolute; right: 0; top: 0;" @click="searchCar">
                                        <img src="/res_apps/car/image/sousu.png" style="width: 12px;height: 12px;">
                                    </span>
                                </el-form-item>

                            </div>
                            <div>
                                <el-form-item label=" 车辆号码：" prop="carNumber">
                                    <el-input v-model="addCustomerFormValue.carNumber" placeholder="请输入车牌号码" style="width: 160px;"></el-input>
                                </el-form-item>

                            </div>

                            <div>
                                <el-form-item label=" 客户备注：" prop="carComments">
                                    <el-input v-model="addCustomerFormValue.carComments" placeholder="请输入客户备注" style="width: 400px;"></el-input>
                                </el-form-item>

                            </div>
                        </div>
                    </el-form>


                </div>
            </div>

            <!-- 车辆受损部位选择 -->
            <div class="Vehicle_damage">
                <div class="Vehicle_damage_text">车辆受损部位选择：
                    <span>{{selectedDots.length}}</span>处</div>
                <div class="car_box">
                    <div class="car_picture">
                        <ul>
                            <li v-for="(item,index) in dots" :key="index" @click="selectDot(item)" :class="findCls(item)">{{item}}
                            </li>

                        </ul>
                    </div>
                </div>


                <!-- 车辆执行项目 -->
                <div class="implement_box">车辆执行项目</div>
                <div class="set_meal">套餐选择：
                    <template>
                        <el-select v-model="packageSelections" multiple filterable allow-create default-first-option @change="selectMaintainPackage(packageSelections)"
                            placeholder="请选择套餐">
                            <el-option v-for="item in packageSelection" :key="item.id" :label="item.packageName" :value="item.id">
                            </el-option>
                        </el-select>
                    </template>
                </div>
                <!-- 列表 -->
                <div class="Table_head">
                    <!-- 表格头部 -->
                    <template>
                        <!--me.addCustomerFormValue.addWorkOrderInputDTO.carExecutionProjects-->
                        <el-form>
                            <el-table :data="addCustomerFormValue.addWorkOrderInputDTO.carExecutionProjects" style="width: 100%" height="360">
                                <el-table-column label="序号" width="50" type="index" align="center">
                                </el-table-column>
                                <el-table-column prop="maintainPackageName" label="所属套餐" type="index" width="200%" align="center">
                                    <template slot-scope="scope">
                                        <el-input v-model="scope.row.maintainPackageName" placeholder="请选择">
                                        </el-input>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="itemName" label="执行项目" align="center">
                                    <template slot-scope='scope'>
                                        <div style=" position: relative; width: 100%; ">
                                            <el-input v-model="scope.row.itemName" placeholder="请搜索">
                                            </el-input>
                                            <span style=" width:20px; height: 20px;  display: inline-block;   cursor:pointer;
                                        border-radius: 50%; position: absolute; right: 2%; top: 30%;" @click='popUpProjectExecution(scope.row)'>
                                                <img src="/res_apps/car/image/sousu.png" style="width: 12px;height: 12px;">
                                            </span>
                                        </div>
                                    </template>
                                </el-table-column>

                                <el-table-column prop="materialName" label="维修材料" type="index" width="200%" align="center">
                                    <template slot-scope='scope'>
                                        <div style=" position: relative; width: 100%; ">
                                            <el-input v-model="scope.row.materialName" placeholder="请搜索">
                                            </el-input>
                                            <span style=" width:20px; height: 20px;  display: inline-block;   cursor:pointer;
                                        border-radius: 50%; position: absolute; right: 2%; top: 30%;" @click='searchForMaterials(scope.row)'>
                                                <img src="/res_apps/car/image/sousu.png" style="width: 12px;height: 12px;">
                                            </span>
                                        </div>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="materialPrice" label="材料单价" align="center">
                                    <template slot-scope="scope">
                                        <el-input v-model="scope.row.materialPrice" placeholder="请输入" @change="materialPriceChange(scope.row)">
                                        </el-input>
                                    </template>

                                </el-table-column>

                                <el-table-column prop="materialQty" label="数量" align="center">
                                    <template slot-scope="scope">
                                        <el-input v-model="scope.row.materialQty" placeholder="请输入" @change="materialQtyChange(scope.row)">
                                        </el-input>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="materialCost" label="维修费用" align="center">
                                    <template slot-scope="scope">
                                        <el-input v-model="scope.row.materialCost" placeholder="请输入">
                                        </el-input>
                                    </template>
                                </el-table-column>

                                <el-table-column prop="workHours" label="工时数" align="center">
                                    <template slot-scope="scope">
                                        <el-input v-model="scope.row.workHours" placeholder="请输入" @change="workHourChange(scope.row)">
                                        </el-input>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="workHourPrice" label="工时单价" align="center">
                                    <template slot-scope="scope">
                                        <el-input v-model="scope.row.workHourPrice" placeholder="请输入" @change="workHourPriceChange(scope.row)">
                                        </el-input>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="workHourDiscount" label="工时折扣" align="center">
                                    <template slot-scope="scope">
                                        <el-input v-model="scope.row.workHourDiscount" placeholder="请输入" @change="workHourDiscountChange(scope.row)">
                                        </el-input>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="workCost" label="工时费" align="center">
                                    <template slot-scope="scope">
                                        <el-input style="color: #000000; " v-model="scope.row.workCost" placeholder="请输入" disabled>
                                        </el-input>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="date" label="操作" align="center">
                                    <template slot-scope="scope">
                                        <el-button type="danger" @click="deletePackageMaterial(scope.row)">删除
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </el-form>
                    </template>
                </div>
                <div class="new_stock_in">
                    <el-button @click='addList'>+ 新增项目</el-button>
                </div>
            </div>
            <!-- 预计完工时间 -->
            <el-form :model="addCustomerFormValue.addWorkOrderInputDTO" label-position="left" label-width="150px" :rules="ruleVerification"
                ref="addCustomerFormValue.addWorkOrderInputDTO">
                <div class="estimated_time">
                    <ul>
                        <li>
                            <div class="block">
                                <span>预计完工时间：</span>
                                <el-date-picker v-model="addCustomerFormValue.addWorkOrderInputDTO.estDate" type="datetime"  placeholder="选择日期时间">
                                </el-date-picker>
                            </div>
                        </li>
                        <li>
                            <div>
                                <el-form-item prop="workEmpId" label="选择项目执行人：" align="center">
                                    <el-select v-model="addCustomerFormValue.addWorkOrderInputDTO.workEmpId" placeholder="请选择维修员">
                                        <el-option v-for="item in projectExecutor" :key="item.id" :label="item.empName" :value="item.id">
                                        </el-option>
                                    </el-select>
                                </el-form-item>
                            </div>
                        </li>
                    </ul>
                </div>
            </el-form>
            <!-- 预估价格 -->
            <div class="Estimated_price">
                <div class="Submit_Msg" v-if="isShow">*内容未填写完整，请检查后提交</div>
                <div>
                    <ul>
                        <li class="Man_hour_fee">
                            <div>预估工时数：
                                <span>{{addCustomerFormValue.addWorkOrderInputDTO.estimateWorkHours}}</span>
                            </div>
                            <div>预估工时费：
                                <i>￥</i>
                                <span>{{addCustomerFormValue.addWorkOrderInputDTO.estimateWorkHoursCost}}</span>
                            </div>
                        </li>

                        <li class="estimated_cost">
                            <div class="estimated_cost_1">预估维修费：
                                <i>￥</i>
                                <span>{{addCustomerFormValue.addWorkOrderInputDTO.estimateMaterialCost}}</span>
                            </div>
                            <div>预估费用合计：
                                <i>￥</i>
                                <span>{{addCustomerFormValue.addWorkOrderInputDTO.workOrderPrice}}</span>
                            </div>
                            <div class="settlement">结算金额：
                                <i>￥</i>
                                <span>0</span>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="Submit_button">
                    <el-button @click="cancelWorkOrder">取消</el-button>
                    <el-button :plain="true" type="primary" @click="submitWorkOrder">提交</el-button>
                </div>
            </div>

            <!-- 右侧内部表单布局容器结束 -->
        </el-main>
        <!-- </el-main> -->

    </div>
</template>
<script>
    export default {
        templateType: 'vue',
        el: 'home',
        data: function () {
            var validatePass2 = (rule, value, callback) => {
                if (value === '') {
                    callback(new Error('请再次输入密码'))
                } else if (value !== this.addEmployeeFormValue.empPassword) {
                    callback(new Error('两次输入密码不一致!'))
                } else {
                    callback()
                }
            };
            return {
                loading:false,
                isShow:false,
                addCustomerFormValue: {
                    addWorkOrderInputDTO: {
                        carComments: "",
                        carExecutionProjects: [
                        ],
                        damageSections: "",
                        estDate: "",
                        orderDate: "",
                        workEmpId: "",
                        workOrderPrice: 0,
                        workOrderStatus: "",
                        workOrderType: "",
                        estimateMaterialCost: 0,
                        estimateWorkHours: 0,
                        estimateWorkHoursCost: 0,
                    },
                    bizType: "",
                    carAttachments: "",
                    carBrand: "",
                    carComments: "",
                    carEntryDate: "",
                    carMarque: "",
                    carMiles: 0,
                    carNumber: "",
                    custFromType: "",
                    custName: "",
                    custPhoneNo: "",
                    deliveryCapacity: "",
                    oilMass: "",
                    receiverId: "",
                    receiverName: "",
                    yearCfg: ""
                },
                // 下拉选项的选择项目执行人的数据
                projectExecutor: [],
                // 套餐选择
                packageSelection: [],
                //    控制小圆点的个数
                selectedDots: [],
                // 添加类名
                dots: [],
                // 选择时间开始数据
                pickerOptions: {
                    shortcuts: [{
                        text: '今天',
                        onClick(picker) {
                            picker.$emit('pick', new Date());
                        }
                    }, {
                        text: '昨天',
                        onClick(picker) {
                            const date = new Date();
                            date.setTime(date.getTime() - 3600 * 1000 * 24);
                            picker.$emit('pick', date);
                        }
                    }, {
                        text: '一周前',
                        onClick(picker) {
                            const date = new Date();
                            date.setTime(date.getTime() - 3600 * 1000 * 24 * 7);
                            picker.$emit('pick', date);
                        }
                    }]
                },

                // 套餐选择
                packageSelections: [],
                // 下拉选项的业务类型的数据
                bizType: [{
                    value: 1,
                    label: '维修业务'
                }, {
                    value: 2,
                    label: '保养业务'
                }, {
                    value: 3,
                    label: '其他业务'
                }
                ],
                // 下拉选项的剩余油量的数据
                surplus: [{
                    value: 1,
                    label: '满油'
                }, {
                    value: 2,
                    label: '四分之三'
                }, {
                    value: 3,
                    label: '二分之一'
                }, {
                    value: 4,
                    label: '四分之一'
                }],
                custFromType: [{
                    value: 1,
                    label: '自主到店'
                }, {
                    value: 2,
                    label: '车友会'
                }],

                // 每个对象的验证规则
                rules: {
                    custName: [
                        { required: true, message: '请输入客户名称' },
                    ],
                    custPhoneNo: [
                        { required: true, message: '请输入客户手机号码', trigger: 'change' },
                        {
                            validator: function (rule, value, callback) {
                                if (/^1[345789]\d{9}$/.test(value) == false) {
                                    callback(new Error("请输入正确的手机号"));
                                } else {
                                    callback();
                                }
                            }, trigger: 'change'
                        }
                    ],
                    carMiles: [
                        { required: true, message: '请输入车辆里程数', trigger: 'blur' },
                        { pattern: /(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/, message: '请输入正确的格式,可保留两位小数' }
                    ],
                    custFromType: [
                        { required: true, message: '请选择客户来源', trigger: 'change' },
                    ],
                    bizType: [
                        { required: true, message: '请选择业务类型', trigger: 'change' },
                    ],
                    oilMass: [
                        { required: true, message: '请选择车载油量', trigger: 'change' },
                    ],
                    carBrand: [
                        { required: true, message: '请选择车辆品牌' },
                    ],
                    carNumber: [
                        { required: true, message: '请填写车牌号码', trigger: 'change' },
                    ],
                    estDate: [
                        {type:'datetime', required: true, message: '请选择预计完成时间', trigger: 'blur' },
                    ],
                    workEmpId: [
                        { required: true, message: '请选择项目执行人', trigger: 'blur' },
                    ],
                },
                // 每个对象的验证规则
                ruleVerification: {
                    estDate: [
                        {type:'datetime', required: true, message: '请选择预计完成时间', trigger: 'blur' },
                    ],
                    workEmpId: [
                        { required: true, message: '请选择项目执行人', trigger: 'blur' },
                    ]
                },
            }
        },
        created() {
        },
        mounted: function () {
            if (this.isLoading) {
                return;
            }
            this.isLoading = true;
            this.dots = [];
            for (var i = 0, len = 37; i < len; i++) {
                this.dots.push(i + 1);
            }

            this.selectedDots = [];
            this.queryMaintainPackageInfo();
            this.queryProjectExecutor();
            this.basicInformation();
        },
        methods: {
            // 返回按钮
            returnCustomerToBePaid: function () {
                oui.router.push("/res_apps/car/html/customer/customer.vue.html", {
                });
            },
            //进入页面就要的数据
            basicInformation: function () {
                let loginUser = window.localStorage.getItem("loginUser");
                let receiver = oui.parseJson(loginUser);
                this.addCustomerFormValue.receiverId = receiver.id;
                this.addCustomerFormValue.receiverName = receiver.empName;
                this.addCustomerFormValue.addWorkOrderInputDTO.orderDate = oui.dateStrByTime(new Date().getTime(), 'yyyy-MM-dd HH:mm:ss');
                this.addCustomerFormValue.carEntryDate = oui.dateStrByTime(new Date().getTime(), 'yyyy-MM-dd HH:mm:ss');
            },
            //计算需要工时
            countEstimateWorkHours: function () {
                let that = this;
                that.addCustomerFormValue.addWorkOrderInputDTO.estimateWorkHours = 0;
                that.addCustomerFormValue.addWorkOrderInputDTO.estimateMaterialCost = 0;
                that.addCustomerFormValue.addWorkOrderInputDTO.estimateWorkHoursCost = 0;
                that.addCustomerFormValue.addWorkOrderInputDTO.workOrderPrice = 0;
                oui.eachArray(that.addCustomerFormValue.addWorkOrderInputDTO.carExecutionProjects, function (packageMaterial) {
                    that.addCustomerFormValue.addWorkOrderInputDTO.estimateWorkHours += parseFloat(packageMaterial.workHours || '0');
                    that.addCustomerFormValue.addWorkOrderInputDTO.estimateMaterialCost += parseFloat(packageMaterial.materialCost || '0');
                    that.addCustomerFormValue.addWorkOrderInputDTO.estimateWorkHoursCost += parseFloat(packageMaterial.workCost || '0');
                    that.addCustomerFormValue.addWorkOrderInputDTO.workOrderPrice = parseFloat(that.addCustomerFormValue.addWorkOrderInputDTO.estimateMaterialCost + that.addCustomerFormValue.addWorkOrderInputDTO.estimateWorkHoursCost);
                });
            },
            workHourChange: function (row) {
                row.workCost = row.workHours * row.workHourPrice * row.workHourDiscount;
                this.countEstimateWorkHours();
            },
            workHourPriceChange: function (row) {
                row.workCost = row.workHours * row.workHourPrice * row.workHourDiscount;
                this.countEstimateWorkHours();
            },
            workHourDiscountChange: function (row) {
                row.workCost = row.workHours * row.workHourPrice * row.workHourDiscount;
                this.countEstimateWorkHours();
            },
            materialPriceChange: function (row) {
                row.materialCost = row.materialPrice * row.materialQty;
                this.countEstimateWorkHours();
            },
            materialQtyChange: function (row) {
                row.materialCost = row.materialPrice * row.materialQty;
                this.countEstimateWorkHours();
            },
            //选择了套餐后
            selectMaintainPackage: function (val) {
                let me = this;
                oui.removeFromArrayBy(me.addCustomerFormValue.addWorkOrderInputDTO.carExecutionProjects, function (item) {
                    if (item.maintainPackageId) {
                        return true;
                    }
                });
                oui.ajaxPost('company/maintainPackage/queryMaintainPackageById', {
                    "ids": val
                }, function (res) {
                    oui.eachArray(res.resultObj, function (packageMaterial) {
                        me.addCustomerFormValue.addWorkOrderInputDTO.carExecutionProjects.push(packageMaterial);
                    });
                    me.countEstimateWorkHours();
                }

                );

            },
            findCls: function (dot) {
                if (this.selectedDots.indexOf(dot) > -1) {
                    return 'Dot_' + dot + ' dot-selected';
                } else {
                    return 'Dot_' + dot;
                }
            },
            selectDot: function (dot) {
                var me = this;
                var idx = me.selectedDots.indexOf(dot);
                if (idx > -1) {
                    me.selectedDots.splice(idx, 1);
                } else {
                    me.selectedDots.push(dot);
                }
                me.addCustomerFormValue.addWorkOrderInputDTO.damageSections = me.selectedDots.join(",");
                me.$forceUpdate();
            },
            // 展示客户弹框页面
            searchCustomer: function (row) {
                // 保存vue的this指向
                var that = this;
                oui.getTop().oui.require4notSort([oui.getContextPath() + 'res_common/oui/ui/ui_pc/css/dialog.css'], function () {

                    oui.getTop().oui.require([oui.getContextPath() + 'res_common/oui/ui/ui_pc/dialog/dialog.js'], function () {
                        //  弹框
                        // 存放底层页面的获取底层页面数据并以org_info这个变量进行保存到全局，弹窗页面在到全局进行获取org_info数据时,
                        // oui.getTop().oui.setPageParam('org_info', oui.parseString(that.ruleForm));
                        var dialog = oui.getTop().oui.showUrlDialog({
                            // 调用弹框方法           + 对应弹框组件的相对路径
                            // url:oui.getContextPath()+'index4vue.html#/res_apps/car/project/html/compnents/components.vue.html',
                            url: oui.getContextPath() + 'index4vue.html#/res_apps/car/html/customer/customersearch.vue.html',
                            // 调整弹窗页面大小
                            contentStyle: 'width:1000px;height:600px',
                            // 是否隐藏底部
                            isHideFooter: false,
                            // 配置按钮的方法，需要传递一个actions数组对象
                            actions: [{
                                // 调用确认按钮的方法
                                text: '确定',
                                cls: 'oui-dialog-ok',//cls:'',//指定自定义样式名 可以实现自定义按钮样式和位置
                                action: function () {
                                    // 获取弹框存的全局变量
                                    var str = oui.getTop().oui.getPageParam('selectCustomerData');
                                    // 在转换为对象
                                    var customerInfo = oui.parseJson(str);
                                    that.addCustomerFormValue.custName = customerInfo.custName;
                                    that.addCustomerFormValue.custPhoneNo = customerInfo.custPhoneNo;
                                    that.addCustomerFormValue.carBrand = customerInfo.carBrand;
                                    that.addCustomerFormValue.carNumber = customerInfo.carNumber;
                                    that.addCustomerFormValue.carMarque = customerInfo.carMarque;
                                    that.addCustomerFormValue.deliveryCapacity = customerInfo.deliveryCapacity;
                                    that.addCustomerFormValue.yearCfg = customerInfo.yearCfg;
                                    dialog.hide();
                                }
                            }, {
                                // 调用取消按钮的方法
                                text: '取消',
                                cls: 'oui-dialog-cancel',//cls:'',//指定自定义样式名 可以实现自定义按钮样式和位置
                                action: function () {
                                    dialog.hide();
                                }
                            }],
                            title: '搜索客户'

                        });
                    });
                });
            },
            //搜索车辆信息
            searchCar: function (row) {
                // 保存vue的this指向
                var that = this;
                oui.getTop().oui.require4notSort([oui.getContextPath() + 'res_common/oui/ui/ui_pc/css/dialog.css'], function () {
                    oui.getTop().oui.require([oui.getContextPath() + 'res_common/oui/ui/ui_pc/dialog/dialog.js'], function () {
                        // oui.getTop().oui.setPageParam('org_info', oui.parseString(that.ruleForm));
                        var dialog = oui.getTop().oui.showUrlDialog({
                            // 调用弹框方法           + 对应弹框组件的相对路径
                            // url:oui.getContextPath()+'index4vue.html#/res_apps/car/project/html/compnents/components.vue.html',
                            url: oui.getContextPath() + 'index4vue.html#/res_apps/car/html/customer/carsearch.vue.html',
                            // 调整弹窗页面大小
                            contentStyle: 'width:1000px;height:600px',
                            // 是否隐藏底部
                            isHideFooter: false,
                            // 配置按钮的方法，需要传递一个actions数组对象
                            actions: [{
                                // 调用确认按钮的方法
                                text: '确定',
                                cls: 'oui-dialog-ok',//cls:'',//指定自定义样式名 可以实现自定义按钮样式和位置
                                action: function () {
                                    // 获取弹框存的全局变量
                                    var str = oui.getTop().oui.getPageParam('selectCarData');
                                    // 在转换为对象
                                    var carInfo = oui.parseJson(str);
                                    that.addCustomerFormValue.carMarque = carInfo.carMarque;
                                    that.addCustomerFormValue.carBrand = carInfo.carBrand;
                                    that.addCustomerFormValue.deliveryCapacity = carInfo.deliveryCapacity;
                                    that.addCustomerFormValue.yearCfg = carInfo.yearCfg;
                                    dialog.hide();
                                }
                            }, {
                                // 调用取消按钮的方法
                                text: '取消',
                                cls: 'oui-dialog-cancel',//cls:'',//指定自定义样式名 可以实现自定义按钮样式和位置
                                action: function () {
                                    dialog.hide();
                                }
                            }],
                            title: '搜索品牌'

                        });
                    });
                });
            },
            // 搜索执行项目
            popUpProjectExecution: function (row) {
                // 保存vue的this指向
                var that = this;
                oui.getTop().oui.require4notSort([oui.getContextPath() + 'res_common/oui/ui/ui_pc/css/dialog.css'], function () {

                    oui.getTop().oui.require([oui.getContextPath() + 'res_common/oui/ui/ui_pc/dialog/dialog.js'], function () {
                        //  弹框
                        // oui.getTop().oui.setPageParam('org_info', oui.parseString(that.ruleForm));
                        var dialog = oui.getTop().oui.showUrlDialog({
                            // 调用弹框方法           + 对应弹框组件的相对路径
                            url: oui.getContextPath() + 'index4vue.html#/res_apps/car/html/customer/projectexecution.vue.html',
                            // 调整弹窗页面大小
                            contentStyle: 'width:800px;height:540px',
                            // 是否隐藏底部
                            isHideFooter: false,
                            // 配置按钮的方法，需要传递一个actions数组对象
                            actions: [{
                                // 调用确认按钮的方法
                                text: '确定',
                                cls: 'oui-dialog-ok',//cls:'',//指定自定义样式名 可以实现自定义按钮样式和位置
                                action: function () {
                                    // 获取弹框存的全局变量
                                    var str = oui.getTop().oui.getPageParam('projectExecutionData');
                                    // 将字符串对象再转换为对象
                                    var maintainItem = oui.parseJson(str);
                                    // 把材料编号赋值给当前页面的input里面
                                    row.itemName = maintainItem.itemName;
                                    row.workHours = maintainItem.itemWorkHours;
                                    that.countEstimateWorkHours();
                                    // console.log(obj.materialCode)
                                    //当弹窗关闭时 清空弹窗自定义的全局变量 方法为oui.getTop().oui.removePageParam("定义的变量名")
                                    oui.getTop().oui.removePageParam('projectExecutionData');
                                    dialog.hide();

                                }
                            }, {
                                // 调用取消按钮的方法
                                text: '取消',
                                cls: 'oui-dialog-cancel',//cls:'',//指定自定义样式名 可以实现自定义按钮样式和位置
                                action: function () {
                                    dialog.hide();
                                }
                            }],
                            title: '选择执行项目'

                        });
                    });
                });
            },
            // 搜索维修材料
            searchForMaterials: function (row) {
                // 保存vue的this指向
                var that = this;
                oui.getTop().oui.require4notSort([oui.getContextPath() + 'res_common/oui/ui/ui_pc/css/dialog.css'], function () {

                    oui.getTop().oui.require([oui.getContextPath() + 'res_common/oui/ui/ui_pc/dialog/dialog.js'], function () {
                        //  弹框
                        // 存放底层页面的获取底层页面数据并以org_info这个变量进行保存到全局，弹窗页面在到全局进行获取org_info数据时,
                        // oui.getTop().oui.setPageParam('org_info', oui.parseString(that.ruleForm));
                        var dialog = oui.getTop().oui.showUrlDialog({
                            // 调用弹框方法           + 对应弹框组件的相对路径
                            // url:oui.getContextPath()+'index4vue.html#/res_apps/car/project/html/compnents/components.vue.html',
                            url: oui.getContextPath() + 'index4vue.html#/res_apps/car/html/customer/repairpopup.vue.html',
                            // 调整弹窗页面大小
                            contentStyle: 'width:1300px;height:700px',
                            // 是否隐藏底部
                            isHideFooter: false,
                            // 配置按钮的方法，需要传递一个actions数组对象
                            actions: [{
                                // 调用确认按钮的方法
                                text: '确定',
                                cls: 'oui-dialog-ok',//cls:'',//指定自定义样式名 可以实现自定义按钮样式和位置
                                action: function () {
                                    // 获取弹框存的全局变量
                                    var str = oui.getTop().oui.getPageParam('selectDataMaintenanceMaterial');
                                    // 将字符串对象再转换为对象
                                    var materialInfo = oui.parseJson(str);
                                    // 把材料编号赋值给当前页面的input里面
                                    row.materialName = materialInfo.materialName;
                                    row.materialId = materialInfo.materialId;
                                    row.materialPrice = materialInfo.materialPrice;
                                    that.countEstimateWorkHours();
                                    //当弹窗关闭时 清空弹窗自定义的全局变量 方法为oui.getTop().oui.removePageParam("定义的变量名")
                                    oui.getTop().oui.removePageParam('selectDataMaintenanceMaterial');
                                    dialog.hide();
                                }
                            }, {
                                // 调用取消按钮的方法
                                text: '取消',
                                cls: 'oui-dialog-cancel',//cls:'',//指定自定义样式名 可以实现自定义按钮样式和位置
                                action: function () {
                                    dialog.hide();
                                }
                            }],
                            title: '维修材料'

                        });
                    });
                });
            },
            // 点击按钮添加新的空列表
            addList() {
                this.addCustomerFormValue.addWorkOrderInputDTO.carExecutionProjects.push({
                    itemName: "",
                    itemType: "",
                    maintainItemId: "",
                    maintainPackageId: "",
                    maintainPackageName: "",
                    materialId: "",
                    materialName: "",
                    materialPrice: 0.00,
                    materialQty: 0.00,
                    materialCost: 0.00,
                    workHourDiscount: 1.00,
                    workHourPrice: 0.00,
                    workHours: 0.00,
                    workCost: 0.00,
                })
            },
            // 删除对应的列表
            deletePackageMaterial: function (row) {
                var idx = this.addCustomerFormValue.addWorkOrderInputDTO.carExecutionProjects.indexOf(row);
                this.addCustomerFormValue.addWorkOrderInputDTO.carExecutionProjects.splice(idx, 1);
                this.countEstimateWorkHours();
            },
            // 查询套餐列表
            queryMaintainPackageInfo: function () {
                var that = this;
                oui.ajaxPost('company/maintainPackage/queryMaintainPackageInfo',
                    {}, function (res) {
                        that.packageSelection = res.resultObj
                    }, function (res) {
                        that.$message.error(res.message)
                    }
                )
            },
            // 获取项目执行人的数据
            queryProjectExecutor: function () {
                var that = this
                oui.ajaxPost('company/employeeInfo/queryWorkOrderEmployee', {},
                    function (res) {
                        that.projectExecutor = res.resultObj;
                    }, function (res) {
                        that.$message.error(res.message)
                    }
                )
            },
            // 把客户添加的信息获取到的数据传递到后端
            submitWorkOrder: function () {
                let me = this;
                this.loading=true;
                this.addCustomerFormValue.addWorkOrderInputDTO.estDate = oui.dateStrByTime(this.addCustomerFormValue.addWorkOrderInputDTO.estDate, 'yyyy-MM-dd HH:mm:ss');
                this.$refs["addCustomerFormValue"].validate((valid) => {
                    if (valid) {
                        this.$refs["addCustomerFormValue.addWorkOrderInputDTO"].validate((valid2) => {
                            if (valid2) {
                                oui.ajaxPost('customer/customerCenter/addCustomerInfo', this.addCustomerFormValue
                                    , function (res) {
                                        me.loading=false;
                                        me.isShow=false;
                                        me.$message({
                                            message: '工单创建成功！',
                                            type: 'success'
                                        });
                                        oui.router.push('res_apps/car/html/customer/customerhaveInHand.vue.html')
                                    }, function (res) {
                                        me.loading=false;
                                        me.$message.error(res.message)
                                    }
                                );
                            } else {
                                me.loading=false;
                                this.isShow=true;
                                this.$message.error('内容未填写完整，请检查修改后重新提交');
                            }
                        });
                    } else {
                        me.loading=false;
                        this.isShow=true;
                        this.$message.error('内容未填写完整，请检查修改后重新提交');
                    }
                });
            },
            cancelWorkOrder:function(){
                oui.router.push("res_apps/car/html/customer/customer.vue.html")
            }


        }
    }
</script>
<style>
    .customer {
        width: 1040px;
        height: 700px;
    }

    html {
        margin: 0 0px;
        /* width: 1040px; */
        /* height: 700px; */
        /* background-color: rgb(243, 228, 21); */
    }

    * {
        padding: 0;
        margin: 0;
        font-size: 14px;
        list-style-type: none;
    }

    /* 设置侧边栏及右侧头部盒子的阴影部分 */

    .el-main {
        width: 100%;
        height: 100%;
        background-color: #f5f5f5;
        color: #333;

    }


    /* 自己的样式 */

    /* 文字盒子span */

    .el-icon-menu>span {
        margin-left: 1px;
    }


    .el-menu {
        border: 0;
        margin: 0 0;
        padding: 0 0;
    }


    /* 面包屑区域 */

    /* .crumbs {
        border: 1px solid rgb(119, 241, 108);

      } */

    /* 面包屑区域开始 -------*/

    .crumbs {
        width: 100%;
        height: 40px;
        line-height: 40px;
        margin-top: 2px;
        background-color: #fff;
    }

    .el-breadcrumb {
        line-height: 40px;
        padding-left: 20px;

    }

    /* 面包屑区域结束------ */

    /* 内容主体区域 */

    .content {
        background-color: #fff;
        padding: 20px;
    }

    /* 第一行内容 */

    .billing_time>ul {
        display: flex;
        justify-content: left;

    }

    .billing_time>ul>li {
        margin-right: 20px;
        width: 270px;
    }

    .billing_time>ul>li>div {
        display: inline-block;
    }

    .billing_time>ul>li>span {
        font-size: 14px;
        color: rgb(0, 0, 0, 0.5);

    }

    .customer_icon .el-input__icon {
        color: #1890FF;
    }

    .list_form {
        margin-top: 28px;
    }

    /* 第二行开始 */

    .v {
        display: flex;
        justify-content: left;

    }

    .v>div {
        margin-right: 30px;
        height: 60px;
    }

    /* 调整全局el-form-item里的文字颜色 */

    .el-form-item__label {
        color: #000000;
    }

    .customer_icon .el-form-item__content {
        color: #1890FF;
    }

    /* 业务类型 */

    .Business_box {
        width: 260px;
        padding-top: 10px;
    }

    .Business_box>div>span {
        margin-left: 40px;
        color: rgb(0, 0, 0, 0.25);
    }

    /* 车辆受损部位选择 */

    .Vehicle_damage {
        background-color: #fff;
        margin-top: 20px;
        padding: 20px 0;
    }

    .Vehicle_damage_text {
        font-size: 16px;
        font-weight: 700;
        margin-bottom: 20px;
        padding-left: 20px;

    }

    .Vehicle_damage_text>span {
        color: #1890FF;
        margin: 0 20px;
        font-size: 16px;
    }

    /* 汽车图片外层盒子 */

    .car_box {
        width: 100%;
        height: 100%;
    }

    .car_picture {
        width: 893px;
        height: 413px;
        background-image: url(/res_apps/car/image/car_image.png);
        background-repeat: no-repeat;
        /* background-color: rgb(67, 128, 80); */
        margin: 0 auto;

    }

    /* 把li转换成小圆点 */

    .car_picture>ul>li {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background-color: rgb(230, 179, 167);
        text-align: center;
    }

    .car_picture>ul {
        position: relative;
    }

    /* 放第一个圆点 */

    .Dot_1 {
        position: absolute;
        top: 42px;
        left: 89px;
        cursor: pointer
    }

    .Dot_2 {
        position: absolute;
        top: 35px;
        left: 130px;
        cursor: pointer
    }

    .Dot_3 {
        position: absolute;
        top: 65px;
        left: 164px;
        cursor: pointer
    }

    .Dot_4 {
        position: absolute;
        top: 111px;
        left: 204px;
        cursor: pointer
    }

    .Dot_5 {
        position: absolute;
        top: 51px;
        left: 224px;
        cursor: pointer
    }

    .Dot_6 {
        position: absolute;
        top: 21px;
        left: 252px;
        cursor: pointer
    }

    .Dot_7 {
        position: absolute;
        top: 59px;
        left: 308px;
        cursor: pointer
    }

    .Dot_8 {
        position: absolute;
        top: 35px;
        left: 368px;
        cursor: pointer
    }

    .Dot_9 {
        position: absolute;
        top: 75px;
        left: 392px;
        cursor: pointer
    }

    .Dot_10 {
        position: absolute;
        top: 49px;
        left: 428px;
        cursor: pointer
    }

    .Dot_11 {
        position: absolute;
        top: 191px;
        left: 31px;
        cursor: pointer
    }

    .Dot_12 {
        position: absolute;
        top: 191px;
        left: 121px;
        cursor: pointer
    }

    .Dot_13 {
        position: absolute;
        top: 191px;
        left: 313px;
        cursor: pointer
    }

    .Dot_14 {
        position: absolute;
        top: 191px;
        left: 434px;
        cursor: pointer
    }

    .Dot_15 {
        position: absolute;
        top: 191px;
        left: 505px;
        cursor: pointer
    }

    .Dot_16 {
        position: absolute;
        top: 337px;
        left: 88px;
        cursor: pointer
    }


    .Dot_17 {
        position: absolute;
        top: 343px;
        left: 131px;
        cursor: pointer
    }

    .Dot_18 {
        position: absolute;
        top: 312px;
        left: 164px;
        cursor: pointer
    }


    .Dot_19 {
        position: absolute;
        top: 255px;
        left: 220px;
        cursor: pointer
    }

    .Dot_20 {
        position: absolute;
        top: 322px;
        left: 224px;
        cursor: pointer
    }

    .Dot_21 {
        position: absolute;
        top: 357px;
        left: 252px;
        cursor: pointer
    }

    .Dot_22 {
        position: absolute;
        top: 317px;
        left: 303px;
        cursor: pointer
    }

    .Dot_23 {
        position: absolute;
        top: 343px;
        left: 368px;
        cursor: pointer
    }

    .Dot_24 {
        position: absolute;
        top: 302px;
        left: 402px;
        cursor: pointer
    }

    .Dot_25 {
        position: absolute;
        top: 327px;
        left: 434px;
        cursor: pointer
    }

    .Dot_26 {
        position: absolute;
        top: 29px;
        left: 709px;
        cursor: pointer
    }

    .Dot_27 {
        position: absolute;
        top: 60px;
        left: 709px;
        cursor: pointer
    }

    .Dot_28 {
        position: absolute;
        top: 97px;
        left: 625px;
        cursor: pointer
    }

    .Dot_29 {
        position: absolute;
        top: 91px;
        left: 709px;
        cursor: pointer
    }

    .Dot_30 {
        position: absolute;
        top: 97px;
        left: 793px;
        cursor: pointer
    }

    .Dot_31 {
        position: absolute;
        top: 151px;
        left: 709px;
        cursor: pointer
    }

    .Dot_32 {
        position: absolute;
        top: 196px;
        left: 709px;
        cursor: pointer
    }

    .Dot_33 {
        position: absolute;
        top: 249px;
        left: 625px;
        cursor: pointer
    }

    .Dot_34 {
        position: absolute;
        top: 243px;
        left: 709px;
        cursor: pointer
    }

    .Dot_35 {
        position: absolute;
        top: 249px;
        left: 790px;
        cursor: pointer
    }

    .Dot_36 {
        position: absolute;
        top: 286px;
        left: 669px;
        cursor: pointer
    }

    .Dot_37 {
        position: absolute;
        top: 286px;
        left: 752px;
        cursor: pointer
    }

    /* 当点击小圆点时变为红色 */

    .car_picture>ul>li.dot-selected {
        background-color: #FF0000;
    }

    /* 车辆执行项目 */

    .implement_box {
        font-size: 16px;
        font-weight: 700;
        padding-left: 20px;
    }

    /* 套餐选择 */

    .set_meal {
        font-weight: 700;
        padding-left: 20px;
        margin: 20px 0;
    }

    /* 列表 */

    .Table_head {
        padding: 0 20px;
    }


    /* 新增项目按钮 */

    .new_stock_in {
        border: 1px dashed #1890FF;
        display: flex;
        justify-content: center;
        margin: 12px 40px 22px 40px;
        border-radius: 4px;
    }

    .new_stock_in>.el-button {
        color: #1890FF;
        border: 1px hidden #fff;
    }

    /* 改变表头的颜色 */

    .el-table th {
        background-color: #eee;
        height: 30px;
    }

    .el-table td {
        height: 30px;
    }

    /* 预计完工时间 */

    .estimated_time {
        background-color: #fff;
        padding: 12px 40px;
        margin: 24px 0;

    }

    .estimated_time>ul {
        display: flex;
        justify-content: left;
    }

    .estimated_time>ul>li {
        margin-right: 90px;
    }

    /* 预估价格 */

    .Estimated_price {
        display: flex;
        justify-content: space-between;
        background-color: #fff;
        height: 56px;
        padding: 0 20px;
        position: relative;
        /* padding-top: 10px; */
    }

    .Man_hour_fee {
        display: flex;
        justify-content: left;

    }

    .Man_hour_fee>div {
        margin-right: 97px;
        margin-top: 6px;
    }

    .Man_hour_fee>div>i {
        font-style: normal;
        color: #1890FF;
    }

    .Man_hour_fee>div>span {
        color: #1890FF;
    }

    /* 预计费用 */

    .estimated_cost {
        display: flex;
        justify-content: left;
    }

    .estimated_cost>div {
        margin-right: 61px;
        margin-top: 6px;
    }

    .estimated_cost>div>i {
        font-style: normal;
        color: #1890FF;
    }

    .estimated_cost>div>span {
        color: #1890FF;
    }

    .estimated_cost_1 {
        margin-right: 69px !important;
    }

    /* 提交按钮 */

    .Submit_button {
        margin-top: 8px;
        
    }

    .Submit_Msg {
        color: #FF0000;
        position: absolute;
        top: -20px;
        right: 5px;
    }

    /* 结算金额 */

    .settlement>span {
        font-size: 18px;
        font-weight: 500;
    }
</style>