/**
 * DEVELOPED BY
 * GIL LOPES BUENO
 * gilbueno.mail@gmail.com
 *
 * WORKS WITH:
 * IE8*, IE 9+, FF 4+, SF 5+, WebKit, CH 7+, OP 12+, BESEN, Rhino 1.7+
 * For IE8 (and other legacy browsers) WatchJS will use dirty checking  
 *
 * FORK:
 * https://github.com/melanke/Watch.JS
 *
 * LICENSE: MIT
 */
"use strict";!function(t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):(window.WatchJS=t(),window.watch=window.WatchJS.watch,window.unwatch=window.WatchJS.unwatch,window.callWatchers=window.WatchJS.callWatchers)}(function(){var t={noMore:!1,useDirtyCheck:!1},e=[],n=[],r=[],o=!1;try{o=Object.defineProperty&&Object.defineProperty({},"x",{})}catch(t){}var a=function(t){return t&&"[object Function]"=={}.toString.call(t)},c=function(t){return"[object Array]"===Object.prototype.toString.call(t)},i=function(t){return"[object Object]"==={}.toString.apply(t)},l=function(t,e){var n=[],r=[];if("string"!=typeof t&&"string"!=typeof e){if(c(t)&&e)for(var o=0;o<t.length;o++)void 0===e[o]&&n.push(o);else for(var o in t)t.hasOwnProperty(o)&&e&&!e.hasOwnProperty(o)&&n.push(o);if(c(e)&&t)for(var a=0;a<e.length;a++)void 0===t[a]&&r.push(a);else for(var a in e)e.hasOwnProperty(a)&&t&&!t.hasOwnProperty(a)&&r.push(a)}return{added:n,removed:r}},s=function(t){if(null==t||"object"!=typeof t)return t;var e=t.constructor();for(var n in t)e[n]=t[n];return e},f=function(t,e,n){try{Object.defineProperty(t,e,{enumerable:!1,configurable:!0,writable:!1,value:n})}catch(r){t[e]=n}},h=function(t,e,r){n[n.length]={prop:e,object:t,orig:s(t[e]),callback:r}},u=function(t,e,n,r){if("string"!=typeof t&&(t instanceof Object||c(t))){if(c(t)){if(m(t,"__watchall__",e,n),void 0===n||n>0)for(var a=0;a<t.length;a++)u(t[a],e,n,r)}else{var i=[];for(a in t)"$val"==a||!o&&"watchers"===a||Object.prototype.hasOwnProperty.call(t,a)&&i.push(a);p(t,i,e,n,r)}r&&F(t,"$$watchlengthsubjectroot",e,n)}},p=function(t,e,n,r,o){if("string"!=typeof t&&(t instanceof Object||c(t)))for(var a=0;a<e.length;a++){var i=e[a];d(t,i,n,r,o)}},d=function(t,e,n,r,o){"string"!=typeof t&&(t instanceof Object||c(t))&&(a(t[e])||(null!=t[e]&&(void 0===r||r>0)&&u(t[e],n,void 0!==r?r-1:r),m(t,e,n,r),o&&(void 0===r||r>0)&&F(t,e,n,r)))},v=function(t,e){if(!(t instanceof String)&&(t instanceof Object||c(t)))if(c(t)){for(var n=["__watchall__"],r=0;r<t.length;r++)n.push(r);w(t,n,e)}else{var o=function(t){var n=[];for(var r in t)t.hasOwnProperty(r)&&(t[r]instanceof Object?o(t[r]):n.push(r));w(t,n,e)};o(t)}},w=function(t,e,n){for(var r in e)e.hasOwnProperty(r)&&C(t,e[r],n)},g=[],_=null;function b(){_=null;for(var t=0;t<g.length;t++)g[t]();g.length=0}var j=function(){return _||(_=setTimeout(b)),_},y=function(t){null==_&&j(),g[g.length]=t},O=function(t,e,n,r){var o=null,a=-1,i=c(t);u(t,function(n,r,c,l){var s=j();if(a!==s&&(a=s,(o={type:"update"}).value=t,o.splices=null,y(function(){e.call(this,o),o=null})),i&&t===this&&null!==o){if("pop"===r||"shift"===r)c=[],l=[l];else if("push"===r||"unshift"===r)c=[c],l=[];else if("splice"!==r)return;o.splices||(o.splices=[]),o.splices[o.splices.length]={index:n,deleteCount:l?l.length:0,addedCount:c?c.length:0,added:c,deleted:l}}},1==n?void 0:0,r)},P=function(t,e,n,r,o){t&&e&&(d(t,e,function(t,e,a,l){var s={type:"update"};s.value=a,s.oldvalue=l,(r&&i(a)||c(a))&&O(a,n,r,o),n.call(this,s)},0),(r&&i(t[e])||c(t[e]))&&O(t[e],n,r,o))},m=function(e,n,r,o){var a=!1,l=c(e);e.watchers||(f(e,"watchers",{}),l&&k(e,function(t,r,a,l){if(D(e,t,r,a,l),0!==o&&a&&(i(a)||c(a))){var s,f,h,p,d=e.watchers[n];for((p=e.watchers.__watchall__)&&(d=d?d.concat(p):p),h=d?d.length:0,s=0;s<h;s++)if("splice"!==r)u(a,d[s],void 0===o?o:o-1);else for(f=0;f<a.length;f++)u(a[f],d[s],void 0===o?o:o-1)}})),e.watchers[n]||(e.watchers[n]=[],l||(a=!0));for(var s=0;s<e.watchers[n].length;s++)if(e.watchers[n][s]===r)return;if(e.watchers[n].push(r),a){var p=e[n],d=function(r,a){var l=p;if(p=r,0!==o&&e[n]&&(i(e[n])||c(e[n]))&&!e[n].watchers){var s,f=e.watchers[n].length;for(s=0;s<f;s++)u(e[n],e.watchers[n][s],void 0===o?o:o-1)}x(e,n)?J(e,n):t.noMore||l!==r&&(a?D(e,n,"set",r,l):S(e,n,"set",r,l),t.noMore=!1)};t.useDirtyCheck?h(e,n,d):function(t,e,n,r){try{Object.defineProperty(t,e,{get:n,set:function(t){r.call(this,t,!0)},enumerable:!0,configurable:!0})}catch(o){try{Object.prototype.__defineGetter__.call(t,e,n),Object.prototype.__defineSetter__.call(t,e,function(t){r.call(this,t,!0)})}catch(n){h(t,e,r)}}}(e,n,function(){return p},d)}},S=function(t,e,n,r,o){if(void 0!==e){var a,c,i=t.watchers[e];(c=t.watchers.__watchall__)&&(i=i?i.concat(c):c),a=i?i.length:0;for(var l=0;l<a;l++)i[l].call(t,e,n,r,o)}else for(var e in t)t.hasOwnProperty(e)&&S(t,e,n,r,o)},W=["pop","push","reverse","shift","sort","slice","unshift","splice"],$=function(t,e,n,r){f(t,n,function(){var o,a,c,i,l=0;if("splice"===n){var s=arguments[0],f=s+arguments[1];for(c=t.slice(s,f),a=[],o=2;o<arguments.length;o++)a[o-2]=arguments[o];l=s}else a=arguments.length>0?arguments[0]:void 0;return i=e.apply(t,arguments),"slice"!==n&&("pop"===n?(c=i,l=t.length):"push"===n?l=t.length-1:"shift"===n?c=i:"unshift"!==n&&void 0===a&&(a=i),r.call(t,l,n,a,c)),i})},k=function(t,e){if(a(e)&&t&&!(t instanceof String)&&c(t))for(var n,r=W.length;r--;)$(t,t[n=W[r]],n,e)},C=function(t,e,n){if(e){if(t.watchers[e])if(void 0===n)delete t.watchers[e];else for(var r=0;r<t.watchers[e].length;r++){t.watchers[e][r]==n&&t.watchers[e].splice(r,1)}}else delete t.watchers;G(t,e,n),I(t,e)},x=function(t,e){return t.watchers&&(t.watchers.__wjs_suspend__||t.watchers["__wjs_suspend__"+e])},J=function(t,e){y(function(){delete t.watchers.__wjs_suspend__,delete t.watchers["__wjs_suspend__"+e]})},M=null,D=function(t,e,n,o,a){r[r.length]={obj:t,prop:e,mode:n,newval:o,oldval:a},null===M&&(M=setTimeout(T))},T=function(){var t=null;M=null;for(var e=0;e<r.length;e++)t=r[e],S(t.obj,t.prop,t.mode,t.newval,t.oldval);t&&(r=[],t=null)},A=function(t,e){var n,r=!0;if(t!==e)if(i(t)){for(n in t)if((o||"watchers"!==n)&&t[n]!==e[n]){r=!1;break}}else r=!1;return r},F=function(t,n,r,o){var a;a=s("$$watchlengthsubjectroot"===n?t:t[n]),e.push({obj:t,prop:n,actual:a,watcher:r,level:o})},G=function(t,n,r){for(var o=0;o<e.length;o++){var a=e[o];a.obj==t&&(n&&a.prop!=n||r&&a.watcher!=r||e.splice(o--,1))}},I=function(t,e){for(var r=0;r<n.length;r++){var o=n[r],a=o.object.watchers;o.object==t&&(!e||o.prop==e)&&a&&(!e||!a[e]||0==a[e].length)&&n.splice(r--,1)}};return setInterval(function(){for(var t=0;t<e.length;t++){var r=e[t];if("$$watchlengthsubjectroot"===r.prop)((o=l(r.obj,r.actual)).added.length||o.removed.length)&&(o.added.length&&p(r.obj,o.added,r.watcher,r.level-1,!0),r.watcher.call(r.obj,"root","differentattr",o,r.actual)),r.actual=s(r.obj);else{var o;if((o=l(r.obj[r.prop],r.actual)).added.length||o.removed.length){if(o.added.length)for(var a=0;a<r.obj.watchers[r.prop].length;a++)p(r.obj[r.prop],o.added,r.obj.watchers[r.prop][a],r.level-1,!0);S(r.obj,r.prop,"differentattr",o,r.actual)}r.actual=s(r.obj[r.prop])}}var c,i;if(n.length>0)for(t=0;t<n.length;t++)i=(c=n[t]).object[c.prop],A(c.orig,i)||(c.orig=s(i),c.callback(i))},50),t.watch=function(){a(arguments[1])?u.apply(this,arguments):c(arguments[1])?p.apply(this,arguments):d.apply(this,arguments)},t.unwatch=function(){a(arguments[1])?v.apply(this,arguments):c(arguments[1])?w.apply(this,arguments):C.apply(this,arguments)},t.callWatchers=S,t.suspend=function(t,e){if(t.watchers){var n="__wjs_suspend__"+(void 0!==e?e:"");t.watchers[n]=!0}},t.onChange=function(){(a(arguments[2])?P:O).apply(this,arguments)},t});