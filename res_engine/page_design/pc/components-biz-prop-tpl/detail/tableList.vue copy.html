<template>
    <div>
        <div class="detail-tabs">
            <div class="detail-tabs-item" v-for="(item,index) in DataList" :key="index" :label="item.label" :name="item.name"
                 @click="changeTabs(index)">
                {{item.label}}
            </div>
            <div class="active-bar" :style="{ transform: 'translateX('+(76 * tabActiveIndex)+'px)'}"></div>
        </div>

        <div class="design-attribute-item" v-show='tabActive=="first"'>
            <oui-include :data="getData4ProjectsFC()" type="module" ref="projectRbacModels"
                         url="res_engine/page_design/pc/components-tpl/property.tpl.vue.html"></oui-include>
        </div>
        <div class="design-attribute-item" v-show='tabActive=="style"'>

            <oui-include :data="getData4ProjectsFCReg()" type="module" ref="projectRbacModelsReg"
                         url="res_engine/page_design/pc/components-tpl/property.tpl.vue.html"></oui-include>
        </div>
        <div class="design-attribute-item" v-show='tabActive=="advanced"'>

            <oui-include :data="getData4ProjectsFCAnimate()" type="module" ref="projectRbacModelsAnimate"
                         url="res_engine/page_design/pc/components-tpl/property.tpl.vue.html"></oui-include>
        </div>





        <el-dialog :visible.sync="centerDialogVisible" custom-class="s-dialog-box" width="960px" :before-close="handleClose"
                   center>
            <div slot="title" class="title" style="text-align: left;">动作交互</div>


            <table class="actionTable">
                <thead>
                <tr>
                    <td class="triggerType">触发方式<span class="icon">>></span></td>
                    <td class="actionName">执行动作<span class="icon">>></span></td>
                    <td class="systemMethod">系统方法<span class="icon">>></span></td>
                    <td class="completed">执行完成后<span class="icon">>></span></td>
                </tr>
                </thead>
                <tbody>
                <tr style="height: 50px;">
                    <td valign="top">

                        <el-select v-model="triggerTypeValue" placeholder="请选择触发方式">
                            <el-option v-for="item in triggerTypeData" :key="item.value" :label="item.label" :value="item.value">
                            </el-option>
                        </el-select>

                        <div style="height: 40px; line-height: 40px;">
                            <el-link type="primary">添加</el-link>

                        </div>

                    </td>
                    <td valign="top">
                        <el-select v-model="actionNameValue" placeholder="选择执行动作">
                            <el-option v-for="item in actionNameData" :key="item.value" :label="item.label" :value="item.value">
                            </el-option>
                        </el-select>
                    </td>
                    <td valign="top">

                        <div style="display: flex; align-items: center;">
                            <div>
                                <el-select class="treeselect" v-if="systemMethodData" ref="select" :value="systemMethodValue"
                                           placeholder="选择逻辑" @visible-change="visibleChange" clearable style="width: 100%;" @clear="clear">
                                    <el-option ref="option" class="option" :value="optionData.id" :label="optionData.name">
                                        <el-tree ref="tree" class="tree" node-key="name" :data="systemMethodData"
                                                 :props="{ label: 'name', children: 'children' } " :default-expanded-keys='[systemMethodValue]'
                                                 highlight-current :expand-on-click-node="false" @node-click="handleNodeClick"
                                                 default-expand-all>
                                        </el-tree>
                                    </el-option>
                                </el-select>

                            </div>
                            <div style="margin-left: 5px;" @click="showBindLogic(optionData.id)">
                                <span class="s-icon s-icon-setting s-icon-16"></span>
                            </div>

                        </div>

                        <div style="display: flex; align-items: center; justify-content: space-between; margin: 10px 0;">
                            <div>
                                显示加载图标
                            </div>
                            <div>

                                <el-switch v-model="showLoadIcon"></el-switch>
                            </div>
                        </div>

                    </td>
                    <td valign="top">

                        <el-select v-model="completedValue" placeholder="执行完成后">
                            <el-option v-for="item in completedData" :key="item.value" :label="item.label" :value="item.value">
                            </el-option>
                        </el-select>

                    </td>
                </tr>

                <tr>
                    <td valign="top">

                    </td>
                    <td valign="top">
                        <!-- <el-select v-model="actionNameValue" placeholder="选择执行动作">
                          <el-option v-for="item in actionNameData" :key="item.value" :label="item.label" :value="item.value">
                          </el-option>
                        </el-select> -->
                    </td>
                    <td valign="top"></td>
                    <td valign="top"></td>
                </tr>

                </tbody>
            </table>





            <span slot="footer" class="dialog-footer">
        <el-button @click="handleClose">取 消</el-button>
        <el-button type="primary" @click="saveActionSetting()">保存</el-button>
      </span>




        </el-dialog>



        <el-dialog :visible.sync="bindingLogicValVisible" custom-class="s-dialog-box" width="880px"
                   :before-close="handleBindLogicValClose" center>
            <div slot="title" class="title" style="text-align: left;">绑定逻辑字段设置</div>

            <el-tabs v-model="logicValTab">
                <el-tab-pane label="输入参数" name="input">


                    <el-table :data="logicInputParams" style="width: 100%; margin-bottom: 10px;"
                              :header-cell-style="{background:'#3A3B3F' }">
                        <el-table-column prop="valname" label="参数名称" width="250">
                            <template slot-scope="scope">
                                <el-select v-model="condition_field[scope.$index]" placeholder="请选择" size="mini" style="width:200px">
                                    <el-option v-for="item in condition_field_options" :key="item.value" :label="item.label"
                                               :value="item.value">
                                    </el-option>
                                </el-select>
                            </template>

                        </el-table-column>

                        <el-table-column prop="name" label="类型" width="150" align="center">
                            <template slot-scope="scope">
                                {{oui.fieldTypeEnum[scope.row.fieldType].desc}}
                            </template>
                        </el-table-column>
                        <el-table-column prop="fieldType" label="来源" align="center">
                            <template slot-scope="scope">
                                输入变量
                            </template>

                        </el-table-column>

                        <el-table-column prop="logicval" label="绑定逻辑定义的输入变量" align="center">
                            <template slot-scope="scope">
                                {{scope.row.name}}:
                                {{oui.fieldTypeEnum[scope.row.fieldType].desc}}
                            </template>

                        </el-table-column>


                    </el-table>

                </el-tab-pane>
                <el-tab-pane label="输出参数" name="output">





                    <el-table :data="logicOutputParams" style="width: 100%; margin-bottom: 10px;"
                              :header-cell-style="{background:'#3A3B3F' }">
                        <el-table-column prop="valname" label="参数名称" width="250">
                            <template slot-scope="scope">
                                <el-select v-model="condition_field[scope.$index]" placeholder="请选择" size="mini" style="width:200px">
                                    <el-option v-for="item in condition_field_options" :key="item.value" :label="item.label"
                                               :value="item.value">
                                    </el-option>
                                </el-select>
                            </template>
                        </el-table-column>

                        <el-table-column prop="name" label="类型" width="150" align="center">
                            <template slot-scope="scope">
                                {{oui.fieldTypeEnum[scope.row.fieldType].desc}}
                            </template>
                        </el-table-column>
                        <el-table-column prop="fieldType" label="来源" align="center">
                            <template slot-scope="scope">
                                输入变量
                            </template>

                        </el-table-column>

                        <el-table-column prop="logicval" label="绑定逻辑定义的输入变量" align="center">
                            <template slot-scope="scope">
                                {{scope.row.name}}:
                                {{oui.fieldTypeEnum[scope.row.fieldType].desc}}
                            </template>

                        </el-table-column>


                </el-tab-pane>
            </el-tabs>



        </el-dialog>



    </div>
</template>

<script>
    exports = {
        data: function () {
            return {
                tableData: [{
                    date: '2016-05-02',
                    name: '王小虎',
                    address: '上海市普陀区金沙江路 1518 弄'
                }, {
                    date: '2016-05-04',
                    name: '王小虎',
                    address: '上海市普陀区金沙江路 1517 弄'
                }, {
                    date: '2016-05-01',
                    name: '王小虎',
                    address: '上海市普陀区金沙江路 1519 弄'
                }, {
                    date: '2016-05-03',
                    name: '王小虎',
                    address: '上海市普陀区金沙江路 1516 弄'
                }],
                logicValTab: 'input',
                condition_field: [],
                condition_field_options: [{
                    value: 'fromData',
                    label: 'fromData'
                }, {
                    value: 'entity',
                    label: 'entity'
                }],
                triggerTypeData: [{
                    value: 'click',
                    label: '单击'
                },
                    {
                        value: 'dbclick',
                        label: '双击'
                    },
                    {
                        value: 'clickBefore',
                        label: '单击前'
                    },
                    {
                        value: 'clickAfter',
                        label: '单击后'
                    },
                    {
                        value: 'dbClickBefore',
                        label: '双击前'
                    },
                    {
                        value: 'dbClickAfter',
                        label: '双击后'
                    },
                    {
                        value: 'mouseover',
                        label: '鼠标移入'
                    },
                    {
                        value: 'mouseout',
                        label: '鼠标移出'
                    },
                    {
                        value: 'mouseup',
                        label: '鼠标按下'
                    },


                ],
                actionNameData: [{
                    value: 'page',
                    label: '页面转向'
                },
                    {
                        value: 'dbClickAfter',
                        label: '后端逻辑'
                    },
                    {
                        value: 'openwindow',
                        label: '弹窗'
                    },
                    {
                        value: 'tips',
                        label: 'Tips'
                    },
                    {
                        value: 'updatelist',
                        label: '更新组件列表'
                    },
                    {
                        value: 'commonapi',
                        label: '公共api'
                    },
                    {
                        value: 'componentapi',
                        label: '组件api'
                    }
                ],
                actionNameValue: '',
                completedData: [{
                    value: 'completed',
                    label: '执行完毕'
                },
                    {
                        value: 'callback',
                        label: '执行回调'
                    }
                ],
                completedValue: '',
                systemMethodData: null,
                systemMethodValue: '',
                Design: com.oui.absolute.AbsoluteDesign,
                getData4ProjectsFC: this.getData4ProjectsFC,
                getData4ProjectsFCReg: this.getData4ProjectsFCReg,
                getData4ProjectsFCAnimate: this.getData4ProjectsFCAnimate,
                projectRbacModels: "",
                projectRbacModelsReg: "",
                projectRbacModelsAnimate: "",
                cache4vue: {},
                cache4vueReg: {},
                cache4vueAnimate: {},
                projects: ["999"],
                tabActiveIndex: 0,
                tabActive: "first",
                activeName: "first",
                centerDialogVisible: false,
                bindingLogicValVisible: false,
                DataList: [{
                    label: "属性",
                    name: "first",
                    content: "first",
                },
                    {
                        label: "样式",
                        name: "style",
                        content: "style",
                    },
                    {
                        label: "高级",
                        name: "advanced",
                        content: "advanced",
                    }
                ],
                property: [{
                    type: "string",
                    name: "id",
                    zhName: "控件id",
                    group: "基础设置",
                    required: false,
                    disabled: true,
                    placeholder: oui.util.componentRandomGenKeyId('tableList'),
                    default: "",
                    suffix: "",
                    max: 30,
                    prepend: "",
                },
                {
                    type: "string",
                    name: "bizId",
                    zhName: "业务id",
                    group: "基础设置",
                    required: false,
                    disabled: false,
                    placeholder: "业务id",
                    default: "",
                    suffix: "",
                    max: 30,
                    prepend: "",
                },
                    {
                        type: "array",
                        name: "otherAttrs.dataSource",
                        zhName: "数据源",
                        group: "基础设置",
                        default: "未绑定",
                        isEvent: true,
                        data:[],
                        actionFun: this.dataSourceFun

                    },
                    {
                        type: "array",
                        name: "otherAttrs.pageSize",
                        zhName: "每页数量",
                        group: "基础设置",
                        default: "10",
                        data:[
                            {value:'10',display:'10'},
                            {value:'20',display:'10'},
                            {value:'30',display:'10'},
                            {value:'50',display:'50'},
                            {value:'100',display:'100'}
                        ],

                    },
                    {
                        type: "radiogroupselect",
                        name: "otherAttrs.searchType",
                        zhName: "搜索条件\n呈现方式",
                        group: "基础设置",
                        default: "simple",
                        data:[
                            {value:'simple',display:'简单'},
                            {value:'repeat',display:'平铺'},
                            {value:'advanced',display:'高级'}
                        ]

                    },
                    {
                        type: "radiogroupselect",
                        name: "otherAttrs.branchStyle",
                        zhName: "分割样式",
                        group: "基础设置",
                        default: "line",
                        data:[{"value":"line","display":"分割线"},{"value":"stripe","display":"斑马纹"},{"value":"none","display":"无"}]

                    },
                    {
                        type: "string",
                        name: "otherAttrs.toolsTitle",
                        zhName: "列名称",
                        group: "操作栏",
                        default: "操作栏",
                    },
                    {
                        type: "switch",
                        name: "otherAttrs.toolsEnable",
                        zhName: "启用",
                        group: "操作栏",
                        radio: true,
                        default: true,
                    },
                    {
                        type: "radiogroupselect",
                        name: "otherAttrs.toolsAlign",
                        zhName: "对齐方式",
                        group: "操作栏",
                        default: 'center',
                        data:[{"value":"left","display":"居左"},{"value":"center","display":"居中"},{"value":"right","display":"居右"}]
                    },
                    {
                        type: "tableListTools",
                        name: "otherAttrs.detailPagebtn",
                        zhName: "",
                        group: "操作栏",
                        SourceList: [],
                        tableListToolsTitle: '详情',
                        needPage: true,
                        needDataSource: false,
                        default: '',
                        data:[],
                        pageData: [],
                    },
                    {
                        type: "tableListTools",
                        name: "otherAttrs.toolsEditbtn",
                        zhName: "",
                        group: "操作栏",
                        SourceList: [],
                        tableListToolsTitle: '编辑',
                        needPage: true,
                        needDataSource: false,
                        default: '',
                        data:[],
                        pageData: [],
                    },
                    {
                        type: "tableListTools",
                        name: "otherAttrs.toolsDeleteBtn",
                        isEvent: true,
                        zhName: "",
                        group: "操作栏",
                        SourceList: [],
                        tableListToolsTitle: '删除',
                        default: '',
                        isAddBtn: false, //是否显示添加按钮
                        data:[],
                        needDataSource: true,
                        actionFun: this.deleteSourceFun
                    },
                    {
                        type: "tableListTools",
                        name: "otherAttrs.toolsAddBtn",
                        zhName: "",
                        group: "工具栏",
                        SourceList: [],
                        tableListToolsTitle: '新增',
                        default: '',
                        data:[],
                        needDataSource: true
                    },
                    {
                        type: "tableListTools",
                        name: "otherAttrs.toolsDelAllBtn",
                        zhName: "",
                        group: "工具栏",
                        SourceList: [],
                        tableListToolsTitle: '批量删除',
                        default: '',
                        isAddBtn: false, //是否显示添加按钮
                        data:[],
                        needDataSource: true
                    }



                ],
                propertyStyle: [{
                    type: "iconselect",
                    name: "otherAttrs.icon",
                    zhName: "头部图标",
                    group: "样式设置",
                    clearable: true,
                    iconlistvisible: false,
                    iconlist: [
                        "el-icon-edit",
                        "el-icon-share",
                        "el-icon-delete",
                        "el-icon-remove",
                        "el-icon-remove-outline",
                        "el-icon-minus",
                        "el-icon-plus",
                        "el-icon-check",
                        "el-icon-picture",
                        "el-icon-user",
                        "el-icon-phone",
                    ],
                    // 其他属性
                },

                    {
                        type: "radiogroupselect",
                        name: "otherAttrs.bjkd",
                        zhName: "布局宽度%",
                        group: "样式设置",
                        required: false,
                        placeholder: "我是占位符",
                        default: "100",
                        data:[{"value":"25","display":"25"},{"value":"50","display":"50"},{"value":"75","display":"75"},{"value":"100","display":"100"}],
                        suffix: "",
                        max: 10,
                        prepend: "",
                    },
                    {
                        type: "string",
                        name: "otherAttrs.fontSize",
                        zhName: "文本字号",
                        group: "样式设置",
                        required: false,
                        placeholder: "文本字号",
                        default: "14",
                        append: "PX",

                    },
                    {
                        type: "colorPicker",
                        name: "otherAttrs.fontColor",
                        zhName: "文字颜色",
                        group: "样式设置",
                        required: false,
                        placeholder: "",
                        default: "#000000",
                        suffix: "",
                        max: 0,
                        prepend: "",
                    },
                    {
                        type: "switch",
                        name: "otherAttrs.fontWeight",
                        zhName: "文字加粗",
                        group: "样式设置",
                        radio: true,
                        default: false,
                        // 其他属性
                    },
                ],
                propertyAdvanced: [{
                    type: "radiogroupselect",
                    name: "otherAttrs.bjkd",
                    zhName: "显示设备",
                    group: "基础设置",
                    required: false,
                    placeholder: "我是占位符",
                    default: "pc",
                    data:[
                  {value:'pc',display:'电脑'},
                  {value:'mobile',display:'手机'},
              ],
                    labelsicon: ["el-icon-s-platform", "el-icon-mobile"],
                    max: 10,
                    prepend: "",
                },
                    {
                        type: "button",
                        name: "otherAttrs.newbtn",
                        zhName: "动作事件",
                        btnText: "新建动作",
                        group: "动作",
                        btnType: "primary",
                        actionFun: this.showActionDialog,
                        isBlock: true,
                        // 其他属性
                    },

                ],
                currentAppLogic: [],
                currentAppLogicValue: [],
                triggerTypeValue: '',
                optionData: {},
                showLoadIcon: "1",
                logicInputParams: [],
                logicOutputParams: [],
                newEvents: {
                    interaction: []
                }
            };
        },
        mounted: function () {

            this.currentControl = this.Design.data.currentControl;
            if (
                this.currentControl &&
                this.currentControl.otherAttrs &&
                this.currentControl.otherAttrs.webPageSrc
            ) {
                this.webPageSrc = this.currentControl.otherAttrs.webPageSrc;
            }

            if (
                this.currentControl &&
                this.currentControl.otherAttrs &&
                this.currentControl.otherAttrs.webPageSrcs
            ) {
                this.webPageSrcs = this.currentControl.otherAttrs.webPageSrcs;
            }
            //更新复制删除工具条标题


            this.loadDataSource('', 1); //加载数据到列表数据源绑定
            this.loadDataSource(1, 11); //加载数据到新增数据源绑定
            this.loadDataSource(4, 12); //加载数据到新增数据源绑定
            this.loadDataSource(2, 9); //加载数据到编辑数据源绑定
            this.loadDataSource(4, 10); //加载数据到删除数据源绑定

            this.loadPageDataSource(2, 'otherAttrs.toolsEditbtn');
            this.loadPageDataSource(3, 'otherAttrs.detailPagebtn');
        },
        methods: {
            dataSourceFun(ref) {
                let itemdata = ref.data.filter((item) => {
                    return item.id == ref.default
                })

                //保存关联的逻辑为事件
                if (itemdata[0]) {

                    let currentControl = com.oui.absolute.AbsoluteDesign.data.currentControl;

                    //查询系统加载事件 是否存在
                    let postData = {
                        "trigMethod": "beforeInit",
                        "executeAction": "backEndLogic",
                        "systemMethod": "logicId",
                        "pageLocation": "",
                        "executePath": "",
                        "linkAddress": "",
                        "renderPage": "",
                        "afterExecuteFinish": "executeFinish",
                        "id": oui.getUUIDLong(),
                        "logicId": itemdata[0].id,
                        "inputParams": JSON.parse(itemdata[0].inputParamsJson),
                        "outputParams": JSON.parse(itemdata[0].outputParamsJson),
                        "superId": ""
                    }

                    this.newEvents.interaction.push(postData)

                    //postData = Object.assign({},currentControl.events,postData)


                    //更新到page中
                    oui.JsonPathUtil.setObjByPath('events', currentControl, this.newEvents, true);
                }



            },
            //删除次逻辑绑定
            deleteSourceFun(ref) {
                let itemdata = ref.data.filter((item) => {
                    return item.id == ref.default
                })

                //保存关联的逻辑为事件
                if (itemdata[0]) {
                    let currentControl = com.oui.absolute.AbsoluteDesign.data.currentControl;

                    let postData = {
                        "trigMethod": "systemDeleteEvent",
                        "executeAction": "backEndLogic",
                        "systemMethod": "logicId",
                        "pageLocation": "",
                        "executePath": "",
                        "linkAddress": "",
                        "renderPage": "",
                        "afterExecuteFinish": "executeFinish",
                        "id": oui.getUUIDLong(),
                        "logicId": itemdata[0].id,
                        "inputParams": JSON.parse(itemdata[0].inputParamsJson),
                        "outputParams": JSON.parse(itemdata[0].outputParamsJson),
                        "superId": ""
                    }

                    //判断是否有删除事件
                    this.newEvents.interaction = this.updateInteractionObj(currentControl.events.interaction,
                        'systemDeleteEvent', postData)
                    //更新到page中
                    oui.JsonPathUtil.setObjByPath('events', currentControl, this.newEvents, true);
                }
            },

            //搜索属性配置并更新
            searchSettingObj(settings, name) {

                if (settings.length > 0) {
                    var _data = [];
                    settings.forEach((setting, index) => {
                        if (setting.name === name) {
                            _data = setting
                        }
                    })

                    return _data
                }
            },
            //更新交互事件
            updateInteractionObj(interactions, name, data) {

                let update_status = false
                interactions.forEach((interaction, index) => {
                    if (interaction.trigMethod === name) {
                        interaction = data
                        update_status = true //更新
                    }
                })

                if (!update_status) { //未更新 新增一条
                    interactions.push(data)
                }

                return interactions

            },
            //加载呈现页页面树
            loadPageDataSource(type, name) {
                var param = oui.getParam()
                var url = this.Design.findPageViewUrl

                var me = this

                oui.postData(url, {
                        projectId: param.projectId,
                        viewType: type
                    },
                    function (res) {

                        let setting = me.searchSettingObj(me.property, name)

                        if (res.projectDesign[0]) {

                            let _pagedata = res.projectDesign[0].children[0].children

                            let temp = [];
                            _pagedata.map((item, index) => {
                                temp.push({
                                    value: item.id,
                                    label: item.name
                                })

                            })

                            setting.pageData = temp
                        }


                    },
                    function (res) {

                    }, '加载中...');
            },

            //加载逻辑 树选择
            loadLogicDataTree() {

                var param = oui.getParam()
                var url = this.Design.queryCurrentModelLogicUrl

                var me = this



                oui.postData(url, {
                        moduleId: com.oui.absolute.AbsoluteDesign.data.moduleId,
                        projectId: param.projectId
                    },
                    function (res) {


                        res.logicTreeNodeList.map((item, index) => {
                            if (item.children.length > 0) {
                                item.disabled = true
                            }
                        })
                        me.systemMethodData = res.logicTreeNodeList

                    },
                    function (res) {

                    }, '加载中...');

            },
            showActionDialog() {

                this.centerDialogVisible = true;

                this.loadLogicDataTree();


            },
            handleNodeClick(data) {
                this.systemMethodValue = data.name
                this.$emit('input', data['id'])
                this.optionData.id = data['id']
                this.optionData.name = data['name']
                this.$refs.select.visible = false
            },
            visibleChange(e) {
                if (e) {
                    let selectDom = document.querySelector('.is-current')
                    setTimeout(() => {
                        this.$refs.select.scrollToOption({
                            $el: selectDom
                        })
                    }, 0)
                }
            },
            clear() {
                this.$emit('input', '')
                console.info('clear')
            },
            //设置逻辑变量
            showBindLogic(data) {
                this.bindingLogicValVisible = true

                var param = oui.getParam()
                oui.postData(param.getLogicByIdUrl, {
                    logicId: data
                }, (res) => {

                    if (res.success) {
                        var inputParamsJson = oui.parseJson(res.logicComponentBean.inputParamsJson)
                        var outputParamsJson = oui.parseJson(res.logicComponentBean.outputParamsJson)

                        this.logicInputParams = inputParamsJson
                        this.logicOutputParams = outputParamsJson
                    }

                }, function (res) {
                    console.log(res);
                }, '加载中...');



            },
            saveActionSetting() {

                //选择的触发方式
                if (this.triggerTypeValue == 'click') {

                }

                var d = oui.getTop().oui.alert('保存成功');
                setTimeout(function () {
                    d.hide();
                }, 800);
            },
            handleClose() {
                this.centerDialogVisible = false
            },
            handleBindLogicValClose() {
                this.bindingLogicValVisible = false
            },
            //读取绑定数据源的列表
            loadDataSource(logicType, dataindex) {
                if (!logicType) {
                    logicType = '';
                }
                var param = oui.getParam()


                oui.postData(this.Design.queryCurrentListQueryLogicUrl, {
                    moduleId: com.oui.absolute.AbsoluteDesign.data.moduleId,
                    projectId: param.projectId,
                    logicType: logicType
                }, (res) => {
                    if (res.success) {
                        var _currentAppLogic = []
                        var _currentAppLogicValue = []
                        var _currentAppLogicData = []
                        res.currentAppLogic.map((item, index) => {
                            _currentAppLogic.push(item.name)
                            _currentAppLogicValue.push(item.id)
                            _currentAppLogicData.push(item)
                        })
                        this.property[dataindex].items = _currentAppLogicValue
                        this.property[dataindex].labels = _currentAppLogic
                        this.property[dataindex].data = _currentAppLogicData


                    }
                }, function (res) {
                    console.log(res);
                }, '加载中...');
            },
            changeTabs(index) {
                this.tabActive = this.DataList[index].name;
                this.tabActiveIndex = index;


            },
            getData4ProjectsFC: function () {
                var me = this;
                var cache4vue = this.getCacheReg(this.cache4vue);
                var bindKey = "projectRbacModels";
                if (!cache4vue[bindKey]) {
                    cache4vue[bindKey] = {
                        notClone4Component: true,
                        clearable: false,
                        id: "projectRbacModels",
                        name: "projectRbacModels",
                        bindProp: "projectRbacModels",
                        value: {
                            name: "1",
                        },
                        property: this.property,
                        data: this.projects || [],
                        onUpdate: function (key, v) {
                            me.onUpdate(key, v);
                        },
                    };
                    me.$set(cache4vue, bindKey, cache4vue[bindKey]);
                }
                return cache4vue[bindKey];
            },
            getCacheReg: function (v) {
                if (!v) {
                    v = {};
                    v = v;
                }
                return v;
            },

            getData4ProjectsFCReg: function () {
                var me = this;
                var cache4vue = this.getCacheReg(this.cache4vueReg);
                var bindKey = "projectRbacModelsReg";
                if (!cache4vue[bindKey]) {
                    cache4vue[bindKey] = {
                        notClone4Component: true,
                        clearable: false,
                        id: "projectRbacModelsReg",
                        name: "projectRbacModelsReg",
                        bindProp: "projectRbacModelsReg",
                        value: {
                            name: "aaaaaaaaaaaaaa",
                        },
                        property: this.propertyStyle,
                        data: this.projects || [],
                        onUpdate: function (key, v) {
                            me.onUpdate(key, v);
                        },
                    };
                    // me.$set(cache4vue, bindKey, cache4vue[bindKey]);
                }
                me.$set(cache4vue, bindKey, cache4vue[bindKey]);

                return cache4vue[bindKey];
            },
            getData4ProjectsFCAnimate: function () {
                var me = this;
                var cache4vue = this.getCacheReg(this.cache4vueAnimate);
                var bindKey = "projectRbacModelsAnimate";
                if (!cache4vue[bindKey]) {
                    cache4vue[bindKey] = {
                        notClone4Component: true,
                        clearable: false,
                        id: "projectRbacModelsAnimate",
                        name: "projectRbacModelsAnimate",
                        bindProp: "projectRbacModelsAnimate",
                        value: {
                            name: "aaaaaaaaaaaaaa",
                        },
                        property: this.propertyAdvanced,
                        webPageSrc: this.webPageSrc,
                        data: this.projects || [],
                        onUpdate: function (key, v) {
                            me.onUpdate(key, v);
                        },
                    };
                    me.$set(cache4vue, bindKey, cache4vue[bindKey]);
                }
                return cache4vue[bindKey];
            },
            onUpdate: function (key, v) {
                var me = this;
                if (key == "projectRbacModels") {
                    me.projectRbacModels = v;
                    if (v) {
                        var one = oui.findOneFromArrayBy(me.projects, function (temp) {
                            if (temp.value == v) {
                                return true;
                            }
                        });
                        if (one) {
                            me.queryPageFieldsByFormIdUrl = one.queryPageFieldsByFormIdUrl;
                        }

                        oui.getData(
                            me.queryPagesByProjectIdUrl, {
                                projectId: v,
                            },
                            function (res) {
                                var pages = res.pages || [];
                                //组织模型所属项目变更后，更新控件数据项
                                oui.eachArray(me.options || [], function (item) {
                                    var data4tableModels = me.findData4tableModels(item);

                                    data4tableModels.queryParams = {
                                        projectId: v,
                                    };
                                    var refKey = "tableModelId_" + item.id;
                                    if (me.$refs[refKey]) {
                                        me.$refs[refKey][0].comp.value = "";
                                        me.$refs[refKey][0].comp.data = oui.parseJson(
                                            oui.parseString(pages)
                                        );
                                        me.$refs[refKey][0].comp.queryParams.projectId = v;
                                    }
                                    //idKey
                                    var refKey4bindId = "tableModelId_id_" + item.id;
                                    if (me.$refs[refKey4bindId]) {
                                        me.$refs[refKey4bindId][0].comp.value = "";
                                        me.$refs[refKey4bindId][0].comp.data = [];
                                    }

                                    //nameKey
                                    var refKey4bindNameId = "tableModelId_name_" + item.id;
                                    if (me.$refs[refKey4bindNameId]) {
                                        me.$refs[refKey4bindNameId][0].comp.value = "";
                                        me.$refs[refKey4bindNameId][0].comp.data = [];
                                    }
                                });
                            }
                        );
                    } else {
                        me.queryPageFieldsByFormIdUrl = "";
                    }
                }
                this.$set(this, key, v);
            },

            handleTabsChange(tab, event) {
                this.tabActive = tab.name;
                if (tab.name === "frist") {
                    this.property = this.property
                } else if (tab.name === "reg") {
                    this.property = this.propertyReg

                } else if (tab.name === "event") {
                    this.property = this.propertyAnimation
                }

            },
            handleWebPageSrcChange: function (val) {
                this.currentControl.otherAttrs.webPageSrc = this.webPageSrc;
                com.oui.absolute.AbsoluteDesign.data.currentControl.otherAttrs.webPageSrc =
                    this.currentControl.otherAttrs.webPageSrc;
            },
            handleWebPageSrcChangeText: function (val) {
                this.currentControl.otherAttrs.webPageSrcs = this.webPageSrcs;
                com.oui.absolute.AbsoluteDesign.data.currentControl.otherAttrs.webPageSrcs =
                    this.currentControl.otherAttrs.webPageSrcs;

                com.oui.absolute.AbsoluteDesign.changed4props(
                    this.currentControl,
                    function () {}
                );
            },
            _controlOnUpdate: function (bindProp, config) {
                console.log(config.id);
                var me = this;
                if (!config.id) {
                    return;
                }
                //获取当前配置变更的对象
                var currentControl = com.oui.absolute.AbsoluteDesign.getControlById(
                    config.id
                );

                if (
                    bindProp &&
                    config &&
                    currentControl &&
                    currentControl.id === config.id
                ) {
                    //根据当前配置的值改变 更新当前控件的值
                    oui.JsonPathUtil.setObjByPath(
                        bindProp,
                        currentControl,
                        oui.JsonPathUtil.getJsonByPath(bindProp, config),
                        true
                    );
                    //清除关系连线
                    me._controlOnUpdate4clearRelation(bindProp, config, currentControl);
                }
            },

        },
    };
</script>

<style>
    .ghost {
        border: 1px dashed indianred;
    }

    .item {
        padding-top: 5px;
        padding-bottom: 5px;
        /*height: 30px;*/
        /*font-size: 14px;*/
    }

    .item-move {
        cursor: move;
    }

    .item-delete {
        padding-left: 5px;
        color: red;
    }

    .item-add {
        padding-left: 5px;
        color: blue;
    }

    .actionTable {
        width: 100%;
        border-collapse: collapse;
        height: 340px;
        border-radius: 4px 4px 0px 0px;
        border: 1px solid #7F7F7F;

    }

    .actionTable thead {
        height: 34px;
        line-height: 34px;
        background: #3A3B3F;
    }

    .actionTable thead td {
        font-size: 14px;
    }

    .actionTable td {
        padding: 5px 10px;
        border: 1px solid #7F7F7F;
    }

    .option {
        height: auto;
        line-height: 1;
        padding: 0;
        background-color: #fff;
    }

    .tree {
        padding: 4px 20px;
        font-weight: 400;
    }
</style>