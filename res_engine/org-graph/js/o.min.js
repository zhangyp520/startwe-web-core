
!function(){var l1lll1111={"package":"com.oui.org","class":"OrgGraph",array2orgTreeMap:function(I1lll111I,l1lll11lI,I1ll1ll1I,I111l11l,I1I111Il){return com.oui.TreeMap.array2treeMap(I1lll111I,l1lll11lI,I1ll1ll1I,I111l11l,I1I111Il)},checkSameDeptName:function(l1lll111I,l1III11I1,I1ll1ll1I){var I111l111=this,I1I111Il=!0,I111II11=I111l111.treeMap.findChildren(I1ll1ll1I)||[],I11111ll=oui.findOneFromArrayBy(I111II11,function(l1lll111l){return l1lll111l.id!=l1lll111I&&l1III11I1==l1lll111l.node.name?!0:void 0});return I11111ll&&(I1I111Il=!1),I1I111Il},show:function(I1lll1111,l1III11Il){var l1II1II1l=this;l1II1II1l.canEdit=l1III11Il,l1II1II1l.treeMap=l1II1II1l.array2orgTreeMap(I1lll1111,"id","parentId","name",!1),l1II1II1l.refreshByRoot(l1II1II1l.treeMap)},findDepts:function(){for(var l1lll1111=this,l1III11II=l1lll1111.treeMap.ids||[],I1ll1ll1I=[],I111I11l=0,I1I111Il=l1III11II.length;I1I111Il>I111I11l;I111I11l++)I1ll1ll1I.push(l1lll1111.treeMap.findNode(l1III11II[I111I11l]).node);return I1ll1ll1I},initValidateCfg:function(){var I1lll111l={deptEdit:{name:{maxLength:20,require:!0,title:"组织名称",failMode:"msgPosEl",msgPos:"append",msgPosEl:"#orgName_error"},limitCount:{minValue:0,maxValue:500,require:!1,title:"编制",failMode:"msgPosEl",msgPos:"append",msgPosEl:"#limitCount_error"},orgCode:{maxLength:20,require:!1,title:"组织编码",failMode:"msgPosEl",msgPos:"append",msgPosEl:"#orgCode_error"},description:{maxLength:249,require:!1,title:"文本描述",failMode:"msgPosEl",msgPos:"append",msgPosEl:"#description_error"}},historyEdit:{name:{maxLength:20,require:!0,title:"版本名称",failMode:"msgPosEl",msgPos:"append",msgPosEl:"#orgVersionName_error"}}};return I1lll111l},findDeptEditValidate:function(){var I1lll111l=this,l1lll11l1=I1lll111l.validate.deptEdit,l1II1II11={};for(var l111I11I in l1lll11l1)l1II1II11[l111I11I]=oui.parseString(l1lll11l1[l111I11I]);return l1II1II11},checkTopForm:function(l1lll1111){var l1lll11ll=oui.getTop().oui.checkForm(l1lll1111);return l1lll11ll?!0:!1},init:function(l1III111l){l1III111l=l1III111l||{};var l1III11II=this;l1III11II.canEdit=!0,template.helper("OrgGraph",this);var I1ll1ll11=oui.loadUrl(oui.getContextPath()+"res_apps/org/departmentManager/common/dept.tpl.html");$("body").append(I1ll1ll11);var I111I11I=oui.getPageParam("depts");l1III11II.data.orgs=oui.parseJson(I111I11I);var l1l111ll=l1III111l.isFlow;if(l1III11II.scale=1,l1III11II.treeMap=l1III11II.array2orgTreeMap(l1III11II.data.orgs,"id","parentId","name",l1l111ll),1!=l1III11II.treeMap.rootIds.length){if(0==l1III11II.treeMap.rootIds.length)return void oui.getTop().oui.alert("没有组织机构根节点");if(l1III11II.treeMap.rootIds.length>1)return void oui.getTop().oui.alert("组织机构根节点存在多个")}l1III11II.validate=l1III11II.initValidateCfg(),l1III11II.menuActionEnum={add:{api:"addDepartment",display:"添加子部门",action:function(I1lll111l,I1III11II,I1ll1ll11,l111I11l){var I1I111Il=oui.getById("view-org"),I111ll1I={org:{id:"",parentId:I1lll111l.id,parentOrgName:I1III11II.findNodeName(I1lll111l.id),name:"新的部门",limitCount:0,leaderId:"",leaderName:"",orgCode:"",description:""},validate:l1III11II.findDeptEditValidate()},l11111II=I1I111Il.getHtmlByTplId("dept-edit-tpl",I111ll1I);l1III11II.dialog4editDept=oui.getTop().oui.showHTMLDialog({title:"添加部门",content:l11111II,actions:[{cls:"oui-dialog-cancel submit-button",text:"取消",action:function(){l1III11II.dialog4editDept.hide()}},{cls:"oui-dialog-ok submit-button",text:"保存",action:function(){var l1lll111l=l1III11II.checkTopForm($(l1III11II.dialog4editDept.getEl()));if(l1lll111l){I111ll1I.org.name=$(l1III11II.dialog4editDept.getEl()).find("[name=orgName]").val();var l1lll111l=l1III11II.checkSameDeptName("new",I111ll1I.org.name,I1lll111l.id);if(!l1lll111l)return void oui.getTop().oui.alert("与同级部门同名");I111ll1I.org.orgCode=$(l1III11II.dialog4editDept.getEl()).find("[name=orgCode]").val(),I111ll1I.org.description=oui.getTop().oui.getById("description4dept").getValue();var l1lll11l1=oui.getTop().oui.getById("selectPerson4leader"),I1ll1ll1l=l1lll11l1.getValue();I111ll1I.org.leaderId=I1ll1ll1l,I111ll1I.org.leaderName=l1lll11l1.getDisplay4readOnly(),I111ll1I.org.limitCount=oui.getTop().oui.getById("limitCount4dept").getValue();var l111I11l=oui.getPageParam("addDeptUrl");oui.postData(l111I11l,I111ll1I.org,function(l1lll1111){if(l1lll1111.success){var I1lll11l1=oui.parseJson(l1lll1111.msg),I1ll1ll1l=I1lll11l1.department||{},I111I11l=I1ll1ll1l;I1III11II.addNode(I111I11l),I1ll1ll11.refreshByNodeId(I1lll111l.id,I1III11II),l1III11II.dialog4editDept.hide()}else oui.getTop().oui.alert("保存部门失败:"+l1lll1111.msg)},function(l1lll1111){oui.getTop().oui.alert(l1lll1111)},"保存中...")}}}]}),oui.getTop().oui.parse({container:$(l1III11II.dialog4editDept.getEl())})}},edit:{action:function(l1lll111l,I1III11II,I1ll1ll1I,I111I111){var l1I111I1=oui.getById("view-org"),l111II1l=[];l1lll111l.node.leaderId&&(l111II1l=[{id:l1lll111l.node.leaderId,typeFlag:"person",name:l1lll111l.node.leaderName||""}]);var I11111II={leaderData:oui.parseString(l111II1l),org:l1lll111l.node,validate:l1III11II.findDeptEditValidate()},l1II1111I=l1I111I1.getHtmlByTplId("dept-edit-tpl",I11111II);l1III11II.dialog4editDept=oui.getTop().oui.showHTMLDialog({title:"编辑部门",content:l1II1111I,actions:[{cls:"oui-dialog-cancel submit-button",text:"取消",action:function(){l1III11II.dialog4editDept.hide()}},{cls:"oui-dialog-ok submit-button",text:"保存",action:function(){I11111II.org.name=$(l1III11II.dialog4editDept.getEl()).find("[name=orgName]").val();var l1III1111=l1III11II.checkTopForm($(l1III11II.dialog4editDept.getEl()));if(l1III1111){var l1III1111=l1III11II.checkSameDeptName(l1lll111l.id,I11111II.org.name,l1lll111l.parentId);if(!l1III1111)return void oui.getTop().oui.alert("与同级部门同名");I11111II.org.orgCode=$(l1III11II.dialog4editDept.getEl()).find("[name=orgCode]").val(),I11111II.org.description=oui.getTop().oui.getById("description4dept").getValue();var l1lll11lI=oui.getTop().oui.getById("selectPerson4leader"),l1ll1ll1l=l1lll11lI.getValue();I11111II.org.leaderId=l1ll1ll1l,I11111II.org.leaderName=l1lll11lI.getDisplay4readOnly(),I11111II.org.limitCount=oui.getTop().oui.getById("limitCount4dept").getValue();var I111l11l=l1lll111l.node.extraAttrs.updateUrl;oui.postData(I111l11l,I11111II.org,function(l1III111I){if(l1III111I.success){var I1lll11ll=oui.parseJson(l1III111I.msg),l1II1II11=I1lll11ll.department||{};l1lll111l.node=l1II1II11,I1ll1ll1I.refreshByNodeId(l1lll111l.id,I1III11II),l1III11II.dialog4editDept.hide()}else oui.getTop().oui.alert("保存部门失败:"+l1III111I.msg)},function(I1III111l){oui.getTop().oui.alert(I1III111l)},"保存中...")}}}]}),oui.getTop().oui.parse({container:$(l1III11II.dialog4editDept.getEl())})}},addParent:{action:function(I1lll111I,I1III11I1,I1II1II1l){if(I1lll111I.parentId){var I111l11I=oui.getById("view-org"),I1l111ll={org:{id:"",parentId:I1lll111I.parentId,parentOrgName:I1III11I1.findNodeName(I1lll111I.parentId),name:"新的部门",limitCount:0,leaderId:"",leaderName:"",orgCode:"",description:""},validate:l1III11II.findDeptEditValidate()},I111II1I=I111l11I.getHtmlByTplId("dept-edit-tpl",I1l111ll);l1III11II.dialog4editDept=oui.getTop().oui.showHTMLDialog({title:"添加部门",content:I111II1I,actions:[{cls:"oui-dialog-cancel submit-button",text:"取消",action:function(){l1III11II.dialog4editDept.hide()}},{cls:"oui-dialog-ok submit-button",text:"保存",action:function(){I1l111ll.org.name=$(l1III11II.dialog4editDept.getEl()).find("[name=orgName]").val();var l1lll111I=l1III11II.checkTopForm($(l1III11II.dialog4editDept.getEl()));if(l1lll111I){var l1lll111I=l1III11II.checkSameDeptName(I1lll111I.id,I1l111ll.org.name,I1lll111I.parentId);if(!l1lll111I)return void oui.getTop().oui.alert("与同级部门同名");I1l111ll.org.orgCode=$(l1III11II.dialog4editDept.getEl()).find("[name=orgCode]").val(),I1l111ll.org.description=oui.getTop().oui.getById("description4dept").getValue();var l1lll11lI=oui.getTop().oui.getById("selectPerson4leader"),I1II1II11=l1lll11lI.getValue();I1l111ll.org.leaderId=I1II1II11,I1l111ll.org.leaderName=l1lll11lI.getDisplay4readOnly(),I1l111ll.org.limitCount=oui.getTop().oui.getById("limitCount4dept").getValue();var I111I111=I1lll111I.node.extraAttrs.addParentUrl||"";oui.postData(I111I111,{department:I1l111ll.org,currentId:I1lll111I.id},function(I1III111I){if(I1III111I.success){var I1lll11l1=oui.parseJson(I1III111I.msg),I1ll1ll1l=I1lll11l1.department||{},I111l11I=I1ll1ll1l,l1l111ll=!I1lll111I.parentId;I1III11I1.addParentNode(I111l11I,I1lll111I),l1l111ll?I1II1II1l.refreshByRoot(I1III11I1):I1II1II1l.refreshByNodeId(I111l11I.parentId,I1III11I1),l1III11II.dialog4editDept.hide()}else oui.getTop().oui.alert("保存部门失败:"+I1III111I.msg)},function(I1III111I){oui.getTop().oui.alert(I1III111I)},"保存中...")}}}]}),oui.getTop().oui.parse({container:$(l1III11II.dialog4editDept.getEl())})}}},addBrother:{action:function(I1III111I,I1lll11lI,I1II1II1l){if(I1III111I.parentId){l1III11II.menuActionEnum.add.action(I1lll11lI.findParent(I1III111I.id),I1lll11lI,I1II1II1l)}}},remove:{action:function(I1lll111I,I1lll11lI,I1ll1ll1I){I1lll111I.parentId&&oui.getTop().oui.confirmDialog("确认删除部门",function(){var I1lll111l=I1lll111I.node.extraAttrs.deleteUrl;oui.postData(I1lll111l,{id:I1lll111I.id,includeChildren:!1},function(I1lll1111){if(I1lll1111.success){var l1lll11l1=I1lll111I.parentId;I1lll11lI.removeNode(I1lll111I),I1ll1ll1I.refreshByNodeId(l1lll11l1,I1lll11lI)}else oui.getTop().oui.alert("删除部门失败:"+I1lll1111.msg)},function(I1lll111I){oui.getTop().oui.alert(I1lll111I)},"删除中...")},function(){})}},removeAll:{action:function(I1lll111I,l1III11I1,l1ll1ll1l){I1lll111I.parentId&&oui.getTop().oui.confirmDialog("确认删除部门",function(){var l1lll111I=I1lll111I.node.extraAttrs.deleteUrl;oui.postData(l1lll111I,{id:I1lll111I.id,includeChildren:!0},function(l1III111I){if(l1III111I.success){var I1III11Il=I1lll111I.parentId;l1III11I1.removeNodeAll(I1lll111I),l1ll1ll1l.refreshByNodeId(I1III11Il,l1III11I1)}else oui.getTop().oui.alert("删除部门失败:"+l1III111I.msg)},function(l1III111l){oui.getTop().oui.alert(l1III111l)},"删除中...")},function(){})}},hideMenu:{action:function(l1III111l,I1lll11lI,l1II1II1l){}},swapSort:{action:function(l1III111I,l1lll11lI,I1ll1ll1l,I111l111){if(l1III111I&&I111l111&&l1III111I.parentId==I111l111.parentId){var l1l111ll=l1III111I.node.extraAttrs.exchangeSortUrl||"";oui.postData(l1l111ll,{currentId:l1III111I.id,targetId:I111l111.id},function(l1lll1111){if(l1lll1111.success){var I1III11Il=l1III111I.node.orgOrder,I1II1II1I=I111l111.node.orgOrder;l1III111I.node.orgOrder=I1II1II1I,I111l111.node.orgOrder=I1III11Il;var I111l11I=l1lll11lI.findNode(l1III111I.parentId);if(I111l11I){var l1I111II=I111l11I.childIds||[],I111ll11=l1I111II.indexOf(l1III111I.id),I11111Il=l1I111II.indexOf(I111l111.id);l1I111II[I111ll11]=I111l111.id,l1I111II[I11111Il]=l1III111I.id}I1ll1ll1l.refreshByNodeId(l1III111I.parentId,l1lll11lI)}else oui.getTop().oui.alert("交换顺序失败:"+l1lll1111.msg)},function(I1III1111){oui.getTop().oui.alert(I1III1111)},"顺序交换中...")}}},swap:{action:function(I1III111l,l1lll11ll,I1ll1ll1I,l111I11I){var I1I111I1=(I1III111l.id,l111I11I.id,l1lll11ll.findNodeName(I1III111l.id)),l111ll11=l1lll11ll.findNodeName(l111I11I.id);l1lll11ll.updateNodeName(I1III111l.id,l111ll11),l1lll11ll.updateNodeName(l111I11I.id,I1I111I1),l1lll11ll.isRoot(I1III111l.id)||l1lll11ll.isRoot(l111I11I.id)?I1ll1ll1I.refreshByRoot(l1lll11ll):(I1ll1ll1I.refreshByNodeId(I1III111l.parentId,l1lll11ll),I1ll1ll1I.refreshByNodeId(l111I11I.parentId,l1lll11ll))}},addChildByTarget:{action:function(l1III1111,I1lll11l1,l1ll1ll11,l111l11I){if(l1III1111.parentId&&!I1lll11l1.hasParents(l1III1111.id,l111l11I.id)){var I1l111l1=l1III1111.node.extraAttrs.updateParentUrl||"";oui.postData(I1l111l1,{currentId:l1III1111.id,targetId:l111l11I.id},function(l1lll111l){if(l1lll111l.success){var l1III11I1=l1III1111.parentId,l1ll1ll1I=l1III1111.id,l1l111l1=I1lll11l1.findNode(l1III11I1);if(l1l111l1&&l1l111l1.childIds){var I111II1I=l1l111l1.childIds.indexOf(l1ll1ll1I);I111II1I>-1&&l1l111l1.childIds.splice(I111II1I,1)}var l11111I1=l111l11I.childIds||[];l11111I1.push(l1ll1ll1I),l111l11I.childIds=l11111I1,l1III1111.parentIds=[l111l11I.id],l1III1111.parentId=l111l11I.id,l1ll1ll11.refreshByNodeId(l111l11I.id,I1lll11l1),l1ll1ll11.refreshByNodeId(l1III11I1,I1lll11l1)}else oui.getTop().oui.alert("调整部门失败:"+l1lll111l.msg)},function(l1III1111){oui.getTop().oui.alert(l1III1111)},"部门调整中...")}}},hideMenu4DragEnd:{action:function(I1III111l,l1III11II,I1ll1ll11,I111I11I){}}},oui.parse({callback:function(){l1III11II.bindEvents()}})},event2hideHistoryOperation:function(l1lll1111){$("#orgHistory").removeClass("oui-operation-show")},event2showOrgHistoryList:function(l1III111I){var l1lll11l1=oui.getPageParam("showHistoryUrl");oui.getData(l1lll11l1,{},function(I1lll111I){if(I1lll111I.success){var l1lll11lI=oui.parseJson(I1lll111I.msg),I1ll1ll1I=l1lll11lI.histories||[],I111l111=oui.getById("view-org"),I1l111l1=I111l111.getHtmlByTplId("org-history-tpl",{versions:I1ll1ll1I}),l111II1l=$("#orgHistory");l111II1l&&l111II1l.length?l111II1l[0].outerHTML=I1l111l1:$("body").append(I1l111l1)}else oui.getTop().oui.alert(I1lll111I.msg)},"加载中..",function(I1III111I){oui.getTop().oui.alert(I1III111I.msg)})},event2showOrgByVersion:function(I1III111l){var l1lll11l1=this,I1II1II11=$(I1III111l.el).attr("version-url");$(".version-active").removeClass("version-active"),$(I1III111l.el).addClass("version-active");oui.getData(I1II1II11,{},function(I1III1111){if(I1III1111.success){var l1lll11ll=oui.parseJson(I1III1111.msg),l1II1II1l=oui.parseJson(l1lll11ll.orgJSON||[]);l1lll11l1.show(l1II1II1l,!1)}else oui.getTop().oui.alert(I1III1111.msg)},"加载中...",function(l1lll111I){oui.getTop().oui.alert(l1lll111I)})},event2delVersion:function(l1III1111){var l1lll11lI=this,l1II1II11=$(l1III1111.el).attr("del-url");oui.getTop().oui.confirmDialog("确认删除版本",function(){oui.postData(l1II1II11,{id:$(l1III1111.el).attr("version-id")},function(I1III111I){I1III111I.success?(oui.getTop().oui.showAutoTips("删除版本成功"),l1lll11lI.event2showOrgHistoryList()):oui.getTop().oui.alert("删除版本失败")},function(l1lll1111){oui.getTop().oui.alert(l1lll1111)},"删除中")},function(){})},event2showCurrOrg:function(I1lll1111){var l1III11I1=window.location.href;oui.go4replace(l1III11I1)},event2saveVersion:function(l1III111l){var I1III11II=this,I1II1II1I=oui.getById("view-org"),I111I11l=I1II1II1I.getHtmlByTplId("org-version-tpl",{version:{},validate:{name:oui.parseString(I1III11II.validate.historyEdit.name)}});I1III11II.versionDialog=oui.getTop().oui.showHTMLDialog({title:"Tips:最多保存50个版本",content:I111I11l,actions:[{cls:"oui-dialog-cancel submit-button",text:"取消",action:function(){I1III11II.versionDialog.hide()}},{cls:"oui-dialog-ok submit-button",text:"保存",action:function(){var l1III111I=oui.getTop().$(I1III11II.versionDialog.getEl()).find("#orgVersionName").val(),I1III11I1=oui.getTop().oui.checkForm($(I1III11II.versionDialog.getEl()));if(I1III11I1){var I1II1II1I=oui.getPageParam("saveVersionUrl");oui.postData(I1II1II1I,{name:l1III111I},function(l1lll111l){l1lll111l.success?(oui.getTop().oui.showAutoTips("保存版本成功"),I1III11II.versionDialog.hide()):oui.getTop().oui.alert("保存版本失败")},function(l1III111I){oui.getTop().oui.alert(l1III111I)})}}}]})},renderOrgChartScale:function(I1lll111l){var l1lll11ll=this,I1II1II1l=$(".orgchart"),l111I11l=I1II1II1l.css("transform")||"none";if(l111I11l.indexOf("matrix")>-1){var I1l111lI=l111I11l.substring(l111I11l.indexOf("(")+1,l111I11l.indexOf(")")),I111ll11=I1l111lI.split(","),I11111ll=parseFloat(I111ll11[0]);parseFloat(I111ll11[2]);I11111ll>1.5&&(I11111ll=1.5),.5>I11111ll&&(I11111ll=.5);var l1ll11111=1,l1I1I11II=50;try{l1ll11111=parseFloat(I111ll11[4]),l1I1I11II=parseFloat(I111ll11[5])}catch(I1I111I11){l1ll11111=1,l1I1I11II=50}l111I11l="matrix("+I11111ll+",0,0,"+I11111ll+","+l1ll11111+","+l1I1I11II+")"}l1lll11ll.scale=1+(0>I1lll111l?-.1:.1),"none"===l111I11l?I1II1II1l.css("transform","scale("+l1lll11ll.scale+","+l1lll11ll.scale+")"):-1===l111I11l.indexOf("3d")?I1II1II1l.css("transform",l111I11l+" scale("+l1lll11ll.scale+","+l1lll11ll.scale+")"):I1II1II1l.css("transform",l111I11l+" scale3d("+l1lll11ll.scale+","+l1lll11ll.scale+", 1)")},event2small:function(l1lll111I){var I1lll11ll=this;I1lll11ll.renderOrgChartScale(-1)},event2big:function(I1III111I){var l1III11II=this;l1III11II.renderOrgChartScale(1)},hideMenu:function(){$(".node",".orgchart").removeClass("allowedDrop"),$(".allowedDropTarget",".orgchart").removeClass("allowedDropTarget"),$(".second-menu").remove()},bindEvents:function(){var l1lll111l=this;l1lll111l.canEdit&&(l1lll111l.dragData={},$(document).on("dragstart",".orgchart .node",function(I1lll1111){$(".node",".orgchart").removeClass("allowedDrop"),$(".allowedDropTarget",".orgchart").removeClass("allowedDropTarget"),l1lll111l.dragData.fromNodeId="",l1lll111l.dragData.toNodeId="",l1lll111l.dragData.timer4dragend=null;var I1lll11lI=$(I1lll1111.target).attr("node-id");I1lll11lI&&(l1lll111l.dragData.fromNodeId=I1lll11lI,l1lll111l.hideMenu())}),$(document).on("dragover",".orgchart .node",function(I1III1111){I1III1111.preventDefault();var l1lll11ll=$(I1III1111.target).attr("node-id")}),$(document).on("dragend",".orgchart .node",function(l1III111I){var l1III11II=$(l1III111I.target).attr("node-id");if(l1III11II){if(l1lll111l.dragData.timer4dragend){try{clearTimeout(l1lll111l.dragData.timer4dragend)}catch(I1II1II1I){}l1lll111l.dragData.timer4dragend=null}l1lll111l.dragData.timer4dragend=setTimeout(function(){console.log("drag end,from:"+l1lll111l.dragData.fromNodeId+",to:"+l1lll111l.dragData.toNodeId),$(".node",".orgchart").removeClass("allowedDrop"),$(".allowedDropTarget",".orgchart").removeClass("allowedDropTarget"),l1lll111l.dragData.fromNodeId!=l1lll111l.dragData.toNodeId&&(l1lll111l.dragEnd(l1lll111l.dragData.fromNodeId,l1lll111l.dragData.toNodeId),l1lll111l.dragData.timer4dragend=null)},1)}}),$(document).on("drop",function(l1lll11lI){var l1ll1ll1I=l1lll11lI.target;if(!$(l1ll1ll1I).hasClass("node")){try{l1ll1ll1I=$(l1ll1ll1I).closest(".node")[0]}catch(I111l11I){}if(!l1ll1ll1I)return}var I1l111ll=$(l1ll1ll1I).attr("node-id");I1l111ll&&(l1lll111l.dragData.toNodeId=I1l111ll)}),$(document).on("mousedown",function(l1lll1111){$(l1lll1111.target).closest(".node").length||l1lll111l.hideMenu()}),$(document).on("mousedown",".manager-content",function(l1lll111I){var l1lll11lI=$(".orgchart");if($(l1lll111I.target).closest(".node").length)return void l1lll11lI.data("panning",!1);l1lll11lI.css("cursor","move").data("panning",!0);var I1II1II1I=0,l111I11l=0,I1I111II=l1lll11lI.css("transform");if("none"!==I1I111II){var l111ll11=I1I111II.split(",");-1===I1I111II.indexOf("3d")?(I1II1II1I=parseInt(l111ll11[4]),l111I11l=parseInt(l111ll11[5])):(I1II1II1I=parseInt(l111ll11[12]),l111I11l=parseInt(l111ll11[13]))}var I11111l1=l1lll111I.pageX-I1II1II1I,I1II11111=l1lll111I.pageY-l111I11l;$(document).on("mousemove",function(l1III111I){var I1lll11l1=l1III111I.pageX-I11111l1,I1ll1ll11=l1III111I.pageY-I1II11111,l111I11I=l1lll11lI.css("transform");if("none"===l111I11I)-1===l111I11I.indexOf("3d")?l1lll11lI.css("transform","matrix(1, 0, 0, 1, "+I1lll11l1+", "+I1ll1ll11+")"):l1lll11lI.css("transform","matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+I1lll11l1+", "+I1ll1ll11+", 0, 1)");else{var I1I111I1=l111I11I.split(",");-1===l111I11I.indexOf("3d")?(I1I111I1[4]=" "+I1lll11l1,I1I111I1[5]=" "+I1ll1ll11+")"):(I1I111I1[12]=" "+I1lll11l1,I1I111I1[13]=" "+I1ll1ll11),l1lll11lI.css("transform",I1I111I1.join(","))}})}),$(document).on("mouseup",function(l1lll1111){var I1lll11lI=$(".orgchart");I1lll11lI.data("panning")&&(I1lll11lI.css("cursor","default"),$(this).off("mousemove"),I1lll11lI.data("panning",!1))}))},refreshByNodeId:function(l1III111I,l1III11I1){var I1II1II11=oui.getById("view-org");if(l1III11I1.isFlow)return void this.refreshByRoot(l1III11I1);var l111I11l=I1II1II11.getHtmlByTplId("org-table-tpl",{treeMap:l1III11I1,nodeId:l1III111I}),I1I111Il=$("[table-node-id="+l1III111I+"]",".orgchart");I1I111Il[0].outerHTML=l111I11l},refreshByRoot:function(l1lll1111){l1lll1111.isFlow;var l1lll11ll=$(".orgchart").attr("style"),I1II1II1I=oui.getById("view-org");I1II1II1I.render(),$(".orgchart").attr("style",l1lll11ll)},expandChildren:function(l1lll111l){var I1III11II=$(l1lll111l.el).closest(".node[node-id]"),I1ll1ll11=I1III11II.attr("node-id"),I111I11I=this;I111I11I.treeMap.expandChildren(I1ll1ll11);var l1I111I1=I111I11I.treeMap.findParent(I1ll1ll11);l1I111I1&&l1I111I1.id?I111I11I.refreshByNodeId(l1I111I1.id,I111I11I.treeMap):I111I11I.refreshByRoot(I111I11I.treeMap)},unExpandChildren:function(I1lll1111){var l1III11II=$(I1lll1111.el).closest(".node[node-id]"),l1ll1ll11=l1III11II.attr("node-id"),I111l11l=this;I111l11l.treeMap.unExpandChildren(l1ll1ll11);var I1I111Il=I111l11l.treeMap.findParent(l1ll1ll11);I1I111Il&&I1I111Il.id?I111l11l.refreshByNodeId(I1I111Il.id,I111l11l.treeMap):I111l11l.refreshByRoot(I111l11l.treeMap)},event2ToggleExpand:function(l1lll111l){var I1III11I1=this,I1ll1ll11=I1III11I1.isRootChildrenUnExpand,I111I111=I1III11I1.treeMap.findRoot();if(I111I111.unExpand=!1,I1ll1ll11){I1III11I1.isRootChildrenUnExpand=!1,$(l1lll111l.el).removeClass("toolbar-group-icon-open"),$(l1lll111l.el).addClass("toolbar-group-icon-close");for(var I1l111l1=I1III11I1.treeMap.findChildIds(I1III11I1.treeMap.findRootId()),I111II1l=0,I11111ll=I1l111l1.length;I11111ll>I111II1l;I111II1l++)I1III11I1.treeMap.expandChildren(I1l111l1[I111II1l])}else{I1III11I1.isRootChildrenUnExpand=!0,$(l1lll111l.el).removeClass("toolbar-group-icon-close"),$(l1lll111l.el).addClass("toolbar-group-icon-open");for(var I1l111l1=I1III11I1.treeMap.findChildIds(I1III11I1.treeMap.findRootId()),I111II1l=0,I11111ll=I1l111l1.length;I11111ll>I111II1l;I111II1l++)I1III11I1.treeMap.unExpandChildren(I1l111l1[I111II1l])}I1III11I1.refreshByRoot(I1III11I1.treeMap)},data:{},getData:function(){return l1lll1111.data},dragEnd:function(I1III111l,I1lll11lI){var l1ll1ll1l=this;if(I1III111l&&I1lll11lI){var I111l111=l1ll1ll1l.treeMap;if(!I111l111.isChild(I1III111l,I1lll11lI)){var l1l111lI=0;if(I111l111.isBrothers(I1III111l,I1lll11lI)&&l1l111lI++,I111l111.isChild(I1III111l,I1lll11lI)||I111l111.hasParents(I1III111l,I1lll11lI)||l1l111lI++,0!=l1l111lI){l1ll1ll1l.dragData.fromNodeId&&l1ll1ll1l.dragData.toNodeId&&($(".node[node-id="+l1ll1ll1l.dragData.fromNodeId+"],.node[node-id="+l1ll1ll1l.dragData.toNodeId+"]",".orgchart").addClass("allowedDrop"),$(".node[node-id="+l1ll1ll1l.dragData.toNodeId+"]",".orgchart").addClass("allowedDropTarget"));var I111ll1I=oui.getById("view-org"),I11111l1=$(".node[node-id="+I1lll11lI+"]",".orgchart"),I1ll11111=I111ll1I.getHtmlByTplId("node-menu-dragend-tpl",{nodeId:I1III111l,targetNodeId:I1lll11lI,treeMap:l1ll1ll1l.treeMap});$(".second-menu",".orgchart").remove(),I11111l1.find(".title").append(I1ll11111)}}}},event2showMenu:function(l1III111l){var l1lll11lI=this;if(l1lll11lI.canEdit){var I1II1II1l=$(l1III111l.el).attr("node-id"),I111I11l=oui.getById("view-org");l1lll11lI.hideMenu();var I1l111ll=I111I11l.getHtmlByTplId("node-menu-tpl",{nodeId:I1II1II1l,treeMap:l1lll11lI.treeMap});$(l1III111l.el).find(".title").append(I1l111ll)}},event2menuAction:function(l1lll111I){var I1III11I1=this;l1lll111I.e.stopPropagation&&l1lll111I.e.stopPropagation();var l1II1II11=$(l1lll111I.el).attr("menu-action-id"),I111I11I=$(l1lll111I.el).attr("node-id"),I1l111l1=$(l1lll111I.el).attr("target-node-id"),l111ll1l=I1III11I1.treeMap,l11111ll=l111ll1l.findNode(I111I11I),I1ll1111I=null;return I1l111l1&&(I1ll1111I=l111ll1l.findNode(I1l111l1)),I1III11I1.menuActionEnum[l1II1II11]&&I1III11I1.menuActionEnum[l1II1II11].action(l11111ll,l111ll1l,I1III11I1,I1ll1111I),I1III11I1.hideMenu(),!1},event2editNodeName:function(I1lll111l){var l1lll11l1=$(I1lll111l.el).attr("node-id"),I1II1II1I=this,I111l11I=oui.getById("view-org"),I1l111ll=I111l11I.getHtmlByTplId("node-name-edit-tpl",{nodeId:l1lll11l1,treeMap:I1II1II1I.treeMap});$(I1lll111l.el).attr("draggable",!1),$(I1lll111l.el).append(I1l111ll),$(I1lll111l.el).find(".title").hide(),$(I1lll111l.el).find("input").focus()},event2updateCurrNodeName:function(I1III111l){var I1III11II=$(I1III111l.el).attr("node-id"),l1ll1ll11=this;l1ll1ll11.treeMap.updateNodeName(I1III11II,$(I1III111l.el).val()),l1ll1ll11.refreshByNodeId(I1III11II,l1ll1ll11.treeMap)},event2exportGraph:function(I1lll1111){var I1III11II=$(".orgchart").parent(),l1II1II11=I1III11II.addClass("canvasContainer").find(".orgchart:visible").get(0),l111l11l=this,I1I111Il=l111l11l.treeMap;I1I111Il.direction||(I1I111Il.direction="");var l111ll1l="l2r"===I1I111Il.direction||"r2l"===I1I111Il.direction,l11111II=function(){var I1lll111I=$("a.download");I1lll111I[0].click()};l111l11l.timer4download=null,html2canvas(l1II1II11,{width:l111ll1l?l1II1II11.clientHeight:l1II1II11.clientWidth,height:l111ll1l?l1II1II11.clientWidth:l1II1II11.clientHeight,onclone:function(I1lll111I){$(I1lll111I).find(".canvasContainer").css("overflow","visible").find(".orgchart:visible:first").css("transform","")},onrendered:function(l1lll111l){var l1lll11ll=$("a.download");l1lll11ll.attr("href",l1lll111l.toDataURL()),l1lll11ll.attr("download",I1I111Il.findNodeName(I1I111Il.findRootId())+".png"),console.log("render..")}}).then(function(){I1III11II.removeClass("canvasContainer"),l111l11l.timer4download||(l111l11l.timer4download=setTimeout(function(){l11111II()},100))},function(){I1III11II.removeClass("canvasContainer")})},event2showOrgLogList:function(l1III1111){var l1lll11ll=oui.getPageParam("showLogUrl");oui.getTop().oui.showUrlDialog({isHideFooter:!0,contentStyle:"width:100%",url:l1lll11ll})},test:function(){alert("hello test")}};l1lll1111=oui.biz.Tool.crateOrUpdateClass(l1lll1111)}();

